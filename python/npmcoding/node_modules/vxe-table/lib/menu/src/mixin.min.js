"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils/methods/xe-utils")),_tools=require("../../tools"),_vXETable=_interopRequireDefault(require("../../v-x-e-table"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _default={methods:{_closeMenu:function(){return Object.assign(this.ctxMenuStore,{visible:!1,selected:null,childPos:null,selectChild:null,showChild:!1}),this.$nextTick()},moveCtxMenu:function(e,t,o,l,i,n,s){var r,u=_xeUtils.default.findIndexOf(s,function(e){return o[l]===e});if(t===i)n&&_tools.UtilTools.hasChildrenList(o.selected)?o.showChild=!0:(o.showChild=!1,o.selectChild=null);else if(38===t){for(var c=u-1;0<=c;c--)if(!1!==s[c].visible){r=s[c];break}o[l]=r||s[s.length-1]}else if(40===t){for(var a=u+1;a<s.length;a++)if(!1!==s[a].visible){r=s[a];break}o[l]=r||s[0]}else!o[l]||13!==t&&32!==t||this.ctxMenuLinkEvent(e,o[l])},handleGlobalContextmenuEvent:function(e){var t=this.$refs,o=this.tId,l=this.editStore,i=this.contextMenu,n=this.ctxMenuStore,s=this.ctxMenuOpts,r=this.mouseConfig,u=this.mouseOpts,c=l.selected,a=["header","body","footer"];if(i){if(n.visible&&t.ctxWrapper&&_tools.DomTools.getEventTargetNode(e,t.ctxWrapper.$el).flag)return void e.preventDefault();if(this._keyCtx){var d="body",h={type:d,$grid:this.$xegrid,$table:this,keyboard:!0,columns:this.visibleColumn.slice(0),$event:e};if(r&&u.area){var f=this.getActiveCellArea();if(f&&f.row&&f.column)return h.row=f.row,h.column=f.column,void this.openContextMenu(e,d,h)}else if(r&&u.selected&&c.row&&c.column)return h.row=c.row,h.column=c.column,void this.openContextMenu(e,d,h)}for(var v=0;v<a.length;v++){var x=a[v],g=_tools.DomTools.getEventTargetNode(e,this.$el,"vxe-".concat(x,"--column"),function(e){return e.parentNode.parentNode.parentNode.getAttribute("data-tid")===o}),p={type:x,$grid:this.$xegrid,$table:this,columns:this.visibleColumn.slice(0),$event:e};if(g.flag){var m=g.targetElem,b=this.getColumnNode(m).item,M="".concat(x,"-");if(Object.assign(p,{column:b,columnIndex:this.getColumnIndex(b),cell:m}),"body"===x){var C=this.getRowNode(m.parentNode).item;M="",p.row=C,p.rowIndex=this.getRowIndex(C)}return this.openContextMenu(e,x,p),void this.emitEvent("".concat(M,"cell-context-menu"),p,e)}if(_tools.DomTools.getEventTargetNode(e,this.$el,"vxe-table--".concat(x,"-wrapper"),function(e){return e.getAttribute("data-tid")===o}).flag)return void("cell"===s.trigger?e.preventDefault():this.openContextMenu(e,x,p))}}t.filterWrapper&&!_tools.DomTools.getEventTargetNode(e,t.filterWrapper.$el).flag&&this.closeFilter(),this.closeMenu()},openContextMenu:function(o,e,l){var f=this,v=this.ctxMenuStore,t=this.ctxMenuOpts,i=t[e],x=t.visibleMethod;if(i){var g=i.options;i.disabled?o.preventDefault():g&&g.length&&(l.options=g,this.preventEvent(o,"event.showMenu",l,null,function(){if(!x||x(l,o)){o.preventDefault(),f.updateZindex();var e=_tools.DomTools.getDomNode(),s=e.scrollTop,r=e.scrollLeft,u=e.visibleHeight,c=e.visibleWidth,a=o.clientY+s,d=o.clientX+r,i=function(){Object.assign(v,{args:l,visible:!0,list:g,selected:null,selectChild:null,showChild:!1,childPos:null,style:{zIndex:f.tZindex,top:"".concat(a,"px"),left:"".concat(d,"px")}}),f.$nextTick(function(){var e=f.$refs.ctxWrapper.$el,t=e.clientHeight,o=e.clientWidth,l=_tools.DomTools.getAbsolutePos(e),i=l.boundingTop,n=l.boundingLeft+o-c;-10<i+t-u&&(v.style.top="".concat(Math.max(s+2,a-t-2),"px")),-10<n&&(v.style.left="".concat(Math.max(r+2,d-o-2),"px")),-220<n&&(v.childPos="left")})},t=l.keyboard,n=l.row,h=l.column;t&&n&&h?f.scrollToRow(n,h).then(function(){var e=f.getCell(n,h),t=_tools.DomTools.getAbsolutePos(e),o=t.boundingTop,l=t.boundingLeft;a=o+s+Math.floor(e.offsetHeight/2),d=l+r+Math.floor(e.offsetWidth/2),i()}):i()}else f.closeMenu()}))}this.closeFilter()},ctxMenuMouseoverEvent:function(e,t,o){var l=this.ctxMenuStore;e.preventDefault(),e.stopPropagation(),l.selected=t,(l.selectChild=o)||(l.showChild=_tools.UtilTools.hasChildrenList(t))},ctxMenuMouseoutEvent:function(e,t){var o=this.ctxMenuStore;t.children||(o.selected=null),o.selectChild=null},ctxMenuLinkEvent:function(e,t){if(!(t.disabled||t.children&&t.children.length)){var o=_vXETable.default.menus.get(t.code),l=Object.assign({menu:t,$grid:this.$xegrid,$table:this,$event:e},this.ctxMenuStore.args);o&&o.call(this,l,e),this.emitEvent("context-menu-click",l,e),this.closeMenu()}}}};exports.default=_default;