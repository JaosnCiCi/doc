"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils/methods/xe-utils")),_conf=_interopRequireDefault(require("../../conf")),_cell=_interopRequireDefault(require("../../cell")),_vXETable=_interopRequireDefault(require("../../v-x-e-table")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var getRowid=_tools.UtilTools.getRowid,getRowkey=_tools.UtilTools.getRowkey,setCellValue=_tools.UtilTools.setCellValue,getCellLabel=_tools.UtilTools.getCellLabel,hasChildrenList=_tools.UtilTools.hasChildrenList,browse=_tools.DomTools.browse,calcHeight=_tools.DomTools.calcHeight,hasClass=_tools.DomTools.hasClass,addClass=_tools.DomTools.addClass,removeClass=_tools.DomTools.removeClass,getEventTargetNode=_tools.DomTools.getEventTargetNode,isWebkit=browse["-webkit"]&&!browse.edge,debounceScrollYDuration=browse.msie?40:20,resizableStorageKey="VXE_TABLE_CUSTOM_COLUMN_WIDTH",visibleStorageKey="VXE_TABLE_CUSTOM_COLUMN_VISIBLE";function getRowUniqueId(){return _xeUtils.default.uniqueId("row_")}function eqCellNull(e){return""===e||_xeUtils.default.eqNull(e)}function eqCellValue(e,t,r){var i=_xeUtils.default.get(e,r),o=_xeUtils.default.get(t,r);return!(!eqCellNull(i)||!eqCellNull(o))||(_xeUtils.default.isString(i)||_xeUtils.default.isNumber(i)?i==o:_xeUtils.default.isEqual(i,o))}function getNextSortOrder(e,t){var r=e.sortOpts.orders,i=t.order||null,o=r.indexOf(i)+1;return r[o<r.length?o:0]}function getCustomStorageMap(e){var t=_conf.default.version,r=_xeUtils.default.toStringJSON(localStorage.getItem(e));return r&&r._v===t?r:{_v:t}}function getRecoverRow(e,t){var r=e.fullAllDataRowMap;return t.filter(function(e){return r.has(e)})}function handleReserveRow(e,t){var r=e.fullDataRowIdData,i=[];return _xeUtils.default.each(t,function(e,t){r[t]&&-1===i.indexOf(r[t].row)&&i.push(r[t].row)}),i}function setMerges(e,t,c,h){if(t){var r=e.treeConfig,u=e.visibleColumn;if(r)throw new Error(_tools.UtilTools.getLog("vxe.error.noTree",["merge-footer-items"]));_xeUtils.default.isArray(t)||(t=[t]),t.forEach(function(e){var t=e.row,r=e.col,i=e.rowspan,o=e.colspan;if(h&&_xeUtils.default.isNumber(t)&&(t=h[t]),_xeUtils.default.isNumber(r)&&(r=u[r]),(h?t:_xeUtils.default.isNumber(t))&&r&&(i||o)&&(i=_xeUtils.default.toNumber(i)||1,o=_xeUtils.default.toNumber(o)||1,1<i||1<o)){var l=_xeUtils.default.findIndexOf(c,function(e){return e._row===t&&e._col===r}),n=c[l];if(n)n.rowspan=i,n.colspan=o,n._rowspan=i,n._colspan=o;else{var s=h?h.indexOf(t):t,a=u.indexOf(r);c.push({row:s,col:a,rowspan:i,colspan:o,_row:t,_col:r,_rowspan:i,_colspan:o})}}})}}function removeMerges(e,t,l,n){var s=[];if(t){var r=e.treeConfig,a=e.visibleColumn;if(r)throw new Error(_tools.UtilTools.getLog("vxe.error.noTree",["merge-cells"]));_xeUtils.default.isArray(t)||(t=[t]),t.forEach(function(e){var t=e.row,r=e.col;n&&_xeUtils.default.isNumber(t)&&(t=n[t]),_xeUtils.default.isNumber(r)&&(r=a[r]);var i=_xeUtils.default.findIndexOf(l,function(e){return e._row===t&&e._col===r});if(-1<i){var o=l.splice(i,1);s.push(o[0])}})}return s}var Methods={getParentElem:function(){return this.$xegrid?this.$xegrid.$el.parentNode:this.$el.parentNode},getParentHeight:function(){return this.$xegrid?this.$xegrid.getParentHeight():this.getParentElem().clientHeight},getExcludeHeight:function(){return this.$xegrid?this.$xegrid.getExcludeHeight():0},clearAll:function(){return this.inited=!1,this.clearSort(),this.clearCurrentRow(),this.clearCurrentColumn(),this.clearRadioRow(),this.clearRadioReserve(),this.clearCheckboxRow(),this.clearCheckboxReserve(),this.clearRowExpand(),this.clearRowExpandReserve(),this.clearTreeExpand(),this.clearTreeExpandReserve(),_vXETable.default._edit&&this.clearActived(),_vXETable.default._filter&&this.clearFilter(),(this.keyboardConfig||this.mouseConfig)&&(this.clearIndexChecked(),this.clearHeaderChecked(),this.clearChecked(),this.clearSelected(),this.clearCopyed(),this.clearCellAreas(),this.clearCopyCellArea()),this.clearScroll()},refreshData:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["refreshData","syncData"]),this.syncData()},syncData:function(){var e=this;return this.$nextTick().then(function(){return e.tableData=[],e.$nextTick().then(function(){return e.loadTableData(e.tableFullData)})})},updateData:function(){return this.handleTableData(!0).then(this.updateFooter).then(this.recalculate)},handleTableData:function(e){var t=this.scrollYLoad,r=this.scrollYStore,i=e?this.updateAfterFullData():this.afterFullData;return this.tableData=t?i.slice(r.startIndex,Math.max(r.startIndex+r.renderSize,1)):i.slice(0),this.$nextTick()},loadTableData:function(e){var t=this,r=this.keepSource,i=this.treeConfig,o=this.editStore,l=this.sYOpts,n=this.scrollYStore,s=e?e.slice(0):[],a=!i&&-1<l.gt&&l.gt<=s.length;return n.startIndex=0,n.visibleIndex=0,o.insertList=[],o.removeList=[],this.tableFullData=s,this.updateCache(!0),this.tableSynchData=e,r&&(this.tableSourceData=_xeUtils.default.clone(s,!0)),(this.scrollYLoad=a)&&(this.height||this.maxHeight||_tools.UtilTools.error("vxe.error.reqProp",["height | max-height"]),this.showOverflow||_tools.UtilTools.warn("vxe.error.reqProp",["show-overflow"]),this.spanMethod&&_tools.UtilTools.warn("vxe.error.scrollErrProp",["span-method"])),this.clearMergeCells(),this.clearMergeFooterItems(),this.handleTableData(!0),this.updateFooter(),this.computeScrollLoad().then(function(){return t.isLoadData=!0,t.computeRowHeight(),t.handleReserveStatus(),t.checkSelectionStatus(),t.$nextTick().then(t.recalculate).then(t.refreshScroll)})},loadData:function(e){return this.inited=!0,this.loadTableData(e).then(this.recalculate)},reloadData:function(e){var t=this;return this.clearAll().then(function(){return t.inited=!0,t.loadTableData(e)}).then(this.handleDefaults)},reloadRow:function(e,t,r){var i=this.tableSourceData,o=this.tableData;if(!this.keepSource)return _tools.UtilTools.warn("vxe.error.reqProp",["keep-source"]),this.$nextTick();var l=this.getRowIndex(e),n=i[l];return n&&e&&(r?_xeUtils.default.set(n,r,_xeUtils.default.get(t||e,r)):t?(i[l]=t,_xeUtils.default.clear(e,void 0),Object.assign(e,this.defineField(Object.assign({},t))),this.updateCache(!0)):_xeUtils.default.destructuring(n,_xeUtils.default.clone(e,!0))),this.tableData=o.slice(0),this.$nextTick()},loadColumn:function(e){var t=this;return this.collectColumn=_xeUtils.default.mapTree(e,function(e){return _cell.default.createColumn(t,e)}),this.$nextTick()},reloadColumn:function(e){return this.clearAll(),this.loadColumn(e)},updateCache:function(s){var a=this,e=this.treeConfig,c=this.treeOpts,t=this.tableFullData,h=this.fullDataRowMap,u=this.fullAllDataRowMap,d=this.fullDataRowIdData,f=this.fullAllDataRowIdData,g=getRowkey(this),x=e&&c.lazy,r=function(e,t,r,i,o){var l=getRowid(a,e);l||(l=getRowUniqueId(),_xeUtils.default.set(e,g,l)),x&&e[c.hasChild]&&_xeUtils.default.isUndefined(e[c.children])&&(e[c.children]=null);var n={row:e,rowid:l,index:t,items:r,parent:o};s&&(d[l]=n,h.set(e,n)),f[l]=n,u.set(e,n)};s&&(d=this.fullDataRowIdData={},h.clear()),f=this.fullAllDataRowIdData={},u.clear(),e?_xeUtils.default.eachTree(t,r,c):t.forEach(r)},appendTreeCache:function(e,t){var r,s=this,i=this.keepSource,o=this.tableSourceData,l=this.treeOpts,a=this.fullDataRowIdData,c=this.fullDataRowMap,h=this.fullAllDataRowMap,u=this.fullAllDataRowIdData,d=l.children,f=l.hasChild,g=getRowkey(this),n=getRowid(this,e);i&&(r=_xeUtils.default.findTree(o,function(e){return n===getRowid(s,e)},l)),_xeUtils.default.eachTree(t,function(e,t,r,i,o){var l=getRowid(s,e);l||(l=getRowUniqueId(),_xeUtils.default.set(e,g,l)),e[f]&&_xeUtils.default.isUndefined(e[d])&&(e[d]=null);var n={row:e,rowid:l,index:t,items:r,parent:o};a[l]=n,c.set(e,n),u[l]=n,h.set(e,n)},l),r&&(r.item[d]=_xeUtils.default.clone(t,!0))},cacheColumnMap:function(){var u,d,f,e=this.isGroup,t=this.tableFullColumn,r=this.collectColumn,g=this.fullColumnMap,x=this.fullColumnIdData={},v=this.fullColumnFieldData={},n=function(e,t,r,i,o){var l=e.id,n=e.property,s=e.fixed,a=e.type,c=e.treeNode,h={column:e,colid:l,index:t,items:r,parent:o};n&&(v[n]&&_tools.UtilTools.warn("vxe.error.fieldRepet",["field",n]),v[n]=h),!f&&s&&(f=s),!u&&c?u=e:d||"expand"!==a||(d=e),x[l]&&_tools.UtilTools.error("vxe.error.fieldRepet",["colId",l]),x[l]=h,g.set(e,h)};g.clear(),e?_xeUtils.default.eachTree(r,function(e,t,r,i,o,l){e.level=l.length,n(e,t,r,0,o)}):t.forEach(n),d&&f&&_tools.UtilTools.warn("vxe.error.errConflicts",["column.fixed","column.type=expand"]),d&&this.mouseOpts.area&&_tools.UtilTools.error("vxe.error.errConflicts",["mouse-config.area","column.type=expand"]),this.treeNodeColumn=u,this.expandColumn=d},getRowNode:function(e){if(e){var t=this.fullAllDataRowIdData[e.getAttribute("data-rowid")];if(t)return{rowid:t.rowid,item:t.row,index:t.index,items:t.items,parent:t.parent}}return null},getColumnNode:function(e){if(e){var t=this.fullColumnIdData[e.getAttribute("data-colid")];if(t)return{colid:t.colid,item:t.column,index:t.index,items:t.items,parent:t.parent}}return null},getRowIndex:function(e){return this.fullDataRowMap.has(e)?this.fullDataRowMap.get(e).index:-1},_getRowIndex:function(e){return this.afterFullData.indexOf(e)},$getRowIndex:function(e){return this.tableData.indexOf(e)},getColumnIndex:function(e){return this.fullColumnMap.has(e)?this.fullColumnMap.get(e).index:-1},_getColumnIndex:function(e){return this.visibleColumn.indexOf(e)},$getColumnIndex:function(e){return this.tableColumn.indexOf(e)},isSeqColumn:function(e){return e&&("seq"===e.type||"index"===e.type)},defineField:function(i){var e=this.treeConfig,t=this.treeOpts,r=getRowkey(this);return this.visibleColumn.forEach(function(e){var t=e.property,r=e.editRender;t&&!_xeUtils.default.has(i,t)&&_xeUtils.default.set(i,t,r&&!_xeUtils.default.isUndefined(r.defaultValue)?r.defaultValue:null)}),e&&t.lazy&&_xeUtils.default.isUndefined(i[t.children])&&(i[t.children]=null),_xeUtils.default.get(i,r)||_xeUtils.default.set(i,r,getRowUniqueId()),i},createData:function(e){var t=this,r=getRowkey(this),i=e.map(function(e){return t.defineField(Object.assign({},e,_defineProperty({},r,null)))});return this.$nextTick().then(function(){return i})},createRow:function(e){var t=this,r=_xeUtils.default.isArray(e);return r||(e=[e]),this.$nextTick().then(function(){return t.createData(e).then(function(e){return r?e:e[0]})})},revert:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["revert","revertData"]),this.revertData.apply(this,arguments)},revertData:function(e,i){var o=this,l=this.tableSourceData,n=this.tableFullData;return this.keepSource?arguments.length?(e&&!_xeUtils.default.isArray(e)&&(e=[e]),e.forEach(function(e){if(!o.isInsertByRow(e)){var t=n.indexOf(e),r=l[t];r&&e&&(i?_xeUtils.default.set(e,i,_xeUtils.default.clone(_xeUtils.default.get(r,i),!0)):_xeUtils.default.destructuring(e,_xeUtils.default.clone(r,!0)))}}),this.$nextTick()):this.reloadData(l):(_tools.UtilTools.warn("vxe.error.reqProp",["keep-source"]),this.$nextTick())},clearData:function(e,t){var r=this.tableFullData,i=this.visibleColumn;return arguments.length?e&&!_xeUtils.default.isArray(e)&&(e=[e]):e=r,t?e.forEach(function(e){return _xeUtils.default.set(e,t,null)}):e.forEach(function(t){i.forEach(function(e){e.property&&setCellValue(t,e,null)})}),this.$nextTick()},isInsertByRow:function(e){return-1<this.editStore.insertList.indexOf(e)},hasRowChange:function(e,t){return _tools.UtilTools.warn("vxe.error.delFunc",["hasRowChange","isUpdateByRow"]),this.isUpdateByRow(e,t)},isUpdateByRow:function(e,t){var r=this,i=this.visibleColumn,o=this.keepSource,l=this.treeConfig,n=this.treeOpts,s=this.tableSourceData,a=this.fullDataRowIdData;if(o){var c,h,u=getRowid(this,e);if(!a[u])return!1;if(l){var d=n.children,f=_xeUtils.default.findTree(s,function(e){return u===getRowid(r,e)},n);e=Object.assign({},e,_defineProperty({},d,null)),f&&(c=Object.assign({},f.item,_defineProperty({},d,null)))}else{c=s[a[u].index]}if(c){if(1<arguments.length)return!eqCellValue(c,e,t);for(var g=0,x=i.length;g<x;g++)if((h=i[g].property)&&!eqCellValue(c,e,h))return!0}}return!1},getColumns:function(e){var t=this.visibleColumn;return arguments.length?t[e]:t.slice(0)},getColumnById:function(e){var t=this.fullColumnIdData;return t[e]?t[e].column:null},getColumnByField:function(e){var t=this.fullColumnFieldData;return t[e]?t[e].column:null},getTableColumn:function(){return{collectColumn:this.collectColumn.slice(0),fullColumn:this.tableFullColumn.slice(0),visibleColumn:this.visibleColumn.slice(0),tableColumn:this.tableColumn.slice(0)}},getRecords:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["getRecords","getData"]),this.getData.apply(this,arguments)},getData:function(e){var t=this.data||this.tableSynchData;return arguments.length?t[e]:t.slice(0)},getAllRecords:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["getAllRecords","getRecordset"]),this.getRecordset()},getSelectRecords:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["getSelectRecords","getCheckboxRecords"]),this.getCheckboxRecords()},getCheckboxRecords:function(){var e=this.tableFullData,t=this.treeConfig,r=this.treeOpts,i=this.checkboxOpts.checkField,o=[];if(i)o=t?_xeUtils.default.filterTree(e,function(e){return _xeUtils.default.get(e,i)},r):e.filter(function(e){return _xeUtils.default.get(e,i)});else{var l=this.selection;o=t?_xeUtils.default.filterTree(e,function(e){return-1<l.indexOf(e)},r):e.filter(function(e){return-1<l.indexOf(e)})}return o},updateAfterFullData:function(){var e=this.visibleColumn,t=this.tableFullData,r=this.remoteSort,h=this.remoteFilter,u=this.filterOpts,i=this.sortOpts,o=t.slice(0),l=_xeUtils.default.find(e,function(e){return e.order}),n=[];if(e.forEach(function(e){if(e.filters&&e.filters.length){var t=[],r=[];e.filters.forEach(function(e){e.checked&&(r.push(e),t.push(e.value))}),n.push({column:e,valueList:t,itemList:r})}}),n.length&&(o=o.filter(function(c){return n.every(function(e){var t=e.column,r=e.valueList,i=e.itemList;if(!r.length||u.remote||h)return!0;var o=t.filterRender,l=t.property,n=t.filterMethod,s=u.filterMethod,a=o?_vXETable.default.renderer.get(o.name):null;return!n&&a&&a.renderFilter&&(n=a.filterMethod),s&&!n?s({options:i,values:r,row:c,column:t}):n?i.some(function(e){return n({value:e.value,option:e,row:c,column:t})}):-1<r.indexOf(_xeUtils.default.get(c,l))})})),l&&l.order){var s=i.sortMethod||this.sortMethod;if(!(_xeUtils.default.isBoolean(l.remoteSort)?l.remoteSort:i.remote||r))if(s)o=s({data:o,column:l,property:l.property,order:l.order,$table:this})||o;else{var a={$table:this},c=l.sortMethod?o.sort(l.sortMethod):_xeUtils.default.sortBy(o,l.sortBy||(l.formatter?function(e){return getCellLabel(e,l,a)}:l.property));o="desc"===l.order?c.reverse():c}}return this.afterFullData=o},getRowById:function(e){var t=this.fullDataRowIdData;return t[e]?t[e].row:null},getRowid:function(e){var t=this.fullAllDataRowMap;return t.has(e)?t.get(e).rowid:null},getTableData:function(){var e=this.tableFullData,t=this.afterFullData,r=this.tableData,i=this.footerData;return{fullData:e.slice(0),visibleData:t.slice(0),tableData:r.slice(0),footerData:i.slice(0)}},handleDefaults:function(){var e=this;(this.checkboxConfig||this.selectConfig)&&this.handleDefaultSelectionChecked(),this.radioConfig&&this.handleDefaultRadioChecked(),this.sortConfig&&this.handleDefaultSort(),this.expandConfig&&this.handleDefaultRowExpand(),this.treeConfig&&this.handleDefaultTreeExpand(),this.mergeCells&&this.handleDefaultMergeCells(),this.mergeFooterItems&&this.handleDefaultMergeFooterItems(),this.$nextTick(function(){return setTimeout(e.recalculate)})},mergeCustomColumn:function(r){var e=this.tableFullColumn;this.isUpdateCustoms=!0,r.length&&e.forEach(function(t){var e=_xeUtils.default.find(r,function(e){return t.property&&(e.field||e.prop)===t.property});e&&(_xeUtils.default.isNumber(e.resizeWidth)&&(t.resizeWidth=e.resizeWidth),_xeUtils.default.isBoolean(e.visible)&&(t.visible=e.visible))}),this.emitEvent("update:customs",e)},resetAll:function(){_tools.UtilTools.warn("vxe.error.delFunc",["resetAll","resetColumn"]),this.resetColumn(!0)},hideColumn:function(e){return e.visible=!1,this.handleCustom()},showColumn:function(e){return e.visible=!0,this.handleCustom()},resetColumn:function(e){var t=this.customOpts.checkMethod,r=Object.assign({visible:!0,resizable:!0===e},e);return this.tableFullColumn.forEach(function(e){r.resizable&&(e.resizeWidth=0),t&&!t({column:e})||(e.visible=e.defaultVisible)}),r.resizable&&this.saveCustomResizable(!0),this.handleCustom()},handleCustom:function(){return this.saveCustomVisible(),this.analyColumnWidth(),this.refreshColumn()},resetResizable:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["resetResizable","resetColumn"]),this.resetColumn()},reloadCustoms:function(e){var t=this;return _tools.UtilTools.warn("vxe.error.delFunc",["reloadCustoms","column.visible & refreshColumn"]),this.$nextTick().then(function(){return t.mergeCustomColumn(e),t.refreshColumn().then(function(){return t.tableFullColumn})})},restoreCustomStorage:function(){var e=this.$toolbar,t=this.collectColumn,r=this.customConfig,i=this.customOpts,o=i.storage,l=!0===i.storage,n=l||o&&o.resizable||e&&e.resizableOpts.storage,s=l||o&&o.visible||e&&e.customOpts.storage;if((r||e)&&(n||s)){var a=r?this.id:e?e.id:null,c={};if(!a)return void _tools.UtilTools.error("vxe.error.reqProp",["id"]);if(n){var h=getCustomStorageMap(resizableStorageKey)[a];h&&_xeUtils.default.each(h,function(e,t){c[t]={field:t,resizeWidth:e}})}if(s){var u=getCustomStorageMap(visibleStorageKey)[a];if(u){var d=u.split("|"),f=d[0]?d[0].split(","):[],g=d[1]?d[1].split(","):[];f.forEach(function(e){c[e]?c[e].visible=!1:c[e]={field:e,visible:!1}}),g.forEach(function(e){c[e]?c[e].visible=!0:c[e]={field:e,visible:!0}})}}var x={};_xeUtils.default.eachTree(t,function(e){var t=e.getKey();t&&(x[t]=e)}),_xeUtils.default.each(c,function(e,t){var r=e.visible,i=e.resizeWidth,o=x[t];o&&(_xeUtils.default.isNumber(i)&&(o.resizeWidth=i),_xeUtils.default.isBoolean(r)&&(o.visible=r))})}},saveCustomVisible:function(){var e=this.$toolbar,t=this.collectColumn,r=this.customConfig,i=this.customOpts,o=i.checkMethod,l=i.storage,n=!0===i.storage||l&&l.visible||e&&e.customOpts.storage;if((r||e)&&n){var s=r?this.id:e?e.id:null,a=getCustomStorageMap(visibleStorageKey),c=[],h=[];if(!s)return void _tools.UtilTools.error("vxe.error.reqProp",["id"]);_xeUtils.default.eachTree(t,function(e){if(!o||o({column:e}))if(!e.visible&&e.defaultVisible){var t=e.getKey();t&&c.push(t)}else if(e.visible&&!e.defaultVisible){var r=e.getKey();r&&h.push(r)}}),a[s]=[c.join(",")].concat(h.length?[h.join(",")]:[]).join("|")||void 0,localStorage.setItem(visibleStorageKey,_xeUtils.default.toJSONString(a))}},saveCustomResizable:function(e){var t=this.$toolbar,r=this.collectColumn,i=this.customConfig,o=this.customOpts,l=o.storage,n=!0===o.storage||l&&l.resizable||t&&t.resizableOpts.storage;if((i||t)&&n){var s,a=i?this.id:t?t.id:null,c=getCustomStorageMap(resizableStorageKey);if(!a)return void _tools.UtilTools.error("vxe.error.reqProp",["id"]);e||(s=_xeUtils.default.isPlainObject(c[a])?c[a]:{},_xeUtils.default.eachTree(r,function(e){if(e.resizeWidth){var t=e.getKey();t&&(s[t]=e.renderWidth)}})),c[a]=_xeUtils.default.isEmpty(s)?void 0:s,localStorage.setItem(resizableStorageKey,_xeUtils.default.toJSONString(c))}},refreshColumn:function(){var e=this,n=[],s=[],a=[],t=this.collectColumn,r=this.tableFullColumn,i=this.isGroup,o=this.columnStore,l=this.sXOpts,c=this.scrollXStore;if(i){var h=[],u=[],d=[];_xeUtils.default.eachTree(t,function(e,t,r,i,o){var l=hasChildrenList(e);o&&o.fixed&&(e.fixed=o.fixed),o&&e.fixed!==o.fixed&&_tools.UtilTools.error("vxe.error.groupFixed"),l?e.visible=!!_xeUtils.default.findTree(e.children,function(e){return hasChildrenList(e)?null:e.visible}):e.visible&&("left"===e.fixed?n.push(e):"right"===e.fixed?a.push(e):s.push(e))}),t.forEach(function(e){e.visible&&("left"===e.fixed?h.push(e):"right"===e.fixed?d.push(e):u.push(e))}),this.tableGroupColumn=h.concat(u).concat(d)}else r.forEach(function(e){e.visible&&("left"===e.fixed?n.push(e):"right"===e.fixed?a.push(e):s.push(e))});var f=n.concat(s).concat(a),g=f,x=-1<l.gt&&l.gt<=r.length;return Object.assign(o,{leftList:n,centerList:s,rightList:a}),x&&i&&(x=!1,_tools.UtilTools.warn("vxe.error.scrollXNotGroup")),x&&(this.showHeader&&!this.showHeaderOverflow&&_tools.UtilTools.warn("vxe.error.reqProp",["show-header-overflow"]),this.showFooter&&!this.showFooterOverflow&&_tools.UtilTools.warn("vxe.error.reqProp",["show-footer-overflow"]),this.spanMethod&&_tools.UtilTools.warn("vxe.error.scrollErrProp",["span-method"]),this.footerSpanMethod&&_tools.UtilTools.warn("vxe.error.scrollErrProp",["footer-span-method"]),Object.assign(c,{startIndex:0,visibleIndex:0}),g=f.slice(c.startIndex,c.startIndex+c.renderSize)),f.length===this.visibleColumn.length&&this.visibleColumn.every(function(e,t){return e===f[t]})||(this.clearMergeCells(),this.clearMergeFooterItems()),this.scrollXLoad=x,this.tableColumn=g,this.visibleColumn=f,this.$nextTick().then(function(){return e.updateFooter(),e.recalculate(!0)}).then(function(){e.updateCellAreas()})},analyColumnWidth:function(){var e=this.columnWidth,t=this.columnMinWidth,r=this.columnOpts,i=r.width||e,o=r.minWidth||t,l=[],n=[],s=[],a=[],c=[],h=[];this.tableFullColumn.forEach(function(e){i&&!e.width&&(e.width=i),o&&!e.minWidth&&(e.minWidth=o),e.visible&&(e.resizeWidth?l.push(e):_tools.DomTools.isPx(e.width)?n.push(e):_tools.DomTools.isScale(e.width)?a.push(e):_tools.DomTools.isPx(e.minWidth)?s.push(e):_tools.DomTools.isScale(e.minWidth)?c.push(e):h.push(e))}),Object.assign(this.columnStore,{resizeList:l,pxList:n,pxMinList:s,scaleList:a,scaleMinList:c,autoList:h})},refreshScroll:function(){var e=this,t=this.lastScrollLeft,r=this.lastScrollTop;return this.clearScroll(),this.$nextTick().then(function(){if(t||r)return e.lastScrollLeft=0,e.lastScrollTop=0,e.scrollTo(t,r)})},recalculate:function(e){var t=this,r=this.$refs,i=r.tableBody,o=r.tableHeader,l=r.tableFooter,n=i?i.$el:null,s=o?o.$el:null,a=l?l.$el:null;return n&&(this.autoCellWidth(s,n,a),!0===e)?this.computeScrollLoad().then(function(){t.autoCellWidth(s,n,a),t.computeScrollLoad()}):this.computeScrollLoad()},autoCellWidth:function(e,t,r){var i=0,o=t.clientWidth,l=o,n=l/100,s=this.fit,a=this.columnStore,c=a.resizeList,h=a.pxMinList,u=a.pxList,d=a.scaleList,f=a.scaleMinList,g=a.autoList;if(h.forEach(function(e){var t=parseInt(e.minWidth);i+=t,e.renderWidth=t}),f.forEach(function(e){var t=Math.floor(parseInt(e.minWidth)*n);i+=t,e.renderWidth=t}),d.forEach(function(e){var t=Math.floor(parseInt(e.width)*n);i+=t,e.renderWidth=t}),u.forEach(function(e){var t=parseInt(e.width);i+=t,e.renderWidth=t}),c.forEach(function(e){var t=parseInt(e.resizeWidth);i+=t,e.renderWidth=t}),n=0<(l-=i)?Math.floor(l/(f.length+h.length+g.length)):0,s?0<l&&f.concat(h).forEach(function(e){i+=n,e.renderWidth+=n}):n=40,g.forEach(function(e){var t=Math.max(n,40);e.renderWidth=t,i+=t}),s){var x=d.concat(f).concat(h).concat(g),v=x.length-1;if(0<v){var p=o-i;if(0<p){for(;0<p&&0<=v;)p--,x[v--].renderWidth++;i=o}}}var w=t.offsetHeight,m=t.scrollHeight>t.clientHeight;if(this.scrollbarWidth=m?t.offsetWidth-o:0,this.overflowY=m,this.tableWidth=i,this.tableHeight=w,e?(this.headerHeight=e.clientHeight,e.scrollLeft!==t.scrollLeft&&(e.scrollLeft=t.scrollLeft)):this.headerHeight=0,r){var C=r.offsetHeight;this.scrollbarHeight=Math.max(C-r.clientHeight,0),this.overflowX=i>r.clientWidth,this.footerHeight=C}else this.footerHeight=0,this.scrollbarHeight=Math.max(w-t.clientHeight,0),this.overflowX=o<i;this.customHeight=calcHeight(this,"height"),this.customMaxHeight=calcHeight(this,"maxHeight"),this.parentHeight=Math.max(this.headerHeight+this.footerHeight+20,this.getParentHeight()),this.overflowX&&this.checkScrolling()},updateStyle:function(){var v=this,t=this.$refs,p=this.isGroup,w=this.fullColumnIdData,m=this.tableColumn,C=this.customHeight,R=this.customMaxHeight,b=this.border,T=this.headerHeight,E=this.showFooter,_=this.showOverflow,y=this.showHeaderOverflow,k=this.showFooterOverflow,S=this.footerHeight,U=this.tableHeight,D=this.tableWidth,O=this.scrollbarHeight,$=this.scrollbarWidth,A=this.scrollXLoad,M=this.scrollYLoad,I=this.cellOffsetWidth,F=this.columnStore,L=this.elemStore,e=this.editStore,r=this.currentRow,i=this.mouseConfig,o=t.emptyPlaceholder,l=L["main-body-wrapper"];return o&&(o.style.top="".concat(T,"px"),o.style.height=l?"".concat(l.offsetHeight-O,"px"):""),0<C&&E&&(C+=O),["main","left","right"].forEach(function(d,e){var f=0<e?d:"",g=F["".concat(f,"List")],x=t["".concat(f,"Container")];["header","body","footer"].forEach(function(c){var e=L["".concat(d,"-").concat(c,"-wrapper")],t=L["".concat(d,"-").concat(c,"-table")];if("header"===c){var r=D;A&&(f&&(m=g),r=m.reduce(function(e,t){return e+t.renderWidth},0)),t&&(t.style.width=r?"".concat(r+$,"px"):"",browse.msie&&_xeUtils.default.arrayEach(t.querySelectorAll(".vxe-resizable"),function(e){e.style.height="".concat(e.parentNode.offsetHeight,"px")}));var i=L["".concat(d,"-").concat(c,"-repair")];i&&(i.style.width="".concat(D,"px"));var o=L["".concat(d,"-").concat(c,"-list")];p&&o&&_xeUtils.default.arrayEach(o.querySelectorAll(".col--group"),function(e){var t=v.getColumnNode(e).item,r=t.showHeaderOverflow,i=_xeUtils.default.isBoolean(r)?r:y,o="title"===i||(!0===i||"tooltip"===i)||"ellipsis"===i,l=0,n=0;o&&_xeUtils.default.eachTree(t.children,function(e){e.children&&t.children.length||n++,l+=e.renderWidth}),e.style.width=o?"".concat(l-n-(b?2:0),"px"):""})}else if("body"===c){var l=L["".concat(d,"-").concat(c,"-emptyBlock")];if(e&&(0<R?e.style.maxHeight="".concat(f?R-T-(E?0:O):R-T,"px"):e.style.height=0<C?"".concat(f?(0<C?C-T-S:U)-(E?0:O):C-T-S,"px"):""),x){var n="right"===f,s=F["".concat(f,"List")];e&&(e.style.top="".concat(T,"px")),x.style.height="".concat((0<C?C-T-S:U)+T+S-O*(E?2:1),"px"),x.style.width="".concat(s.reduce(function(e,t){return e+t.renderWidth},n?$:0),"px")}var a=D;f&&_?a=(m=g).reduce(function(e,t){return e+t.renderWidth},0):A&&(f&&(m=g),a=m.reduce(function(e,t){return e+t.renderWidth},0)),t&&(t.style.width=a?"".concat(a,"px"):"",t.style.paddingRight=$&&f&&(browse["-moz"]||browse.safari)?"".concat($,"px"):""),l&&(l.style.width=a?"".concat(a,"px"):"")}else if("footer"===c){var h=D;f&&_?h=(m=g).reduce(function(e,t){return e+t.renderWidth},0):A&&(f&&(m=g),h=m.reduce(function(e,t){return e+t.renderWidth},0)),e&&(x&&(e.style.top="".concat(0<C?C-S:U+T,"px")),e.style.marginTop="".concat(-O,"px")),t&&(t.style.width=h?"".concat(h+$,"px"):"")}var u=L["".concat(d,"-").concat(c,"-colgroup")];u&&_xeUtils.default.arrayEach(u.children,function(e){var t=e.getAttribute("name");if("col_gutter"===t&&(e.style.width="".concat($,"px")),w[t]){var r,s=w[t].column,i=s.showHeaderOverflow,o=s.showFooterOverflow,l=s.showOverflow;e.style.width="".concat(s.renderWidth,"px");var a="title"===(r="header"===c?_xeUtils.default.isUndefined(i)||_xeUtils.default.isNull(i)?y:i:"footer"===c?_xeUtils.default.isUndefined(o)||_xeUtils.default.isNull(o)?k:o:_xeUtils.default.isUndefined(l)||_xeUtils.default.isNull(l)?_:l)||(!0===r||"tooltip"===r)||"ellipsis"===r,n=L["".concat(d,"-").concat(c,"-list")];"header"===c||"footer"===c?A&&!a&&(a=!0):!A&&!M||a||(a=!0),n&&_xeUtils.default.arrayEach(n.querySelectorAll(".".concat(s.id)),function(e){var t=parseInt(e.getAttribute("colspan")||1),r=e.querySelector(".vxe-cell"),i=s.renderWidth;if(r){if(1<t)for(var o=v.getColumnIndex(s),l=1;l<t;l++){var n=v.getColumns(o+l);n&&(i+=n.renderWidth)}r.style.width=a?"".concat(i-I*t,"px"):""}})}})})}),r&&this.setCurrentRow(r),i&&i.selected&&e.selected.row&&e.selected.column&&this.addColSdCls(),this.$nextTick()},checkScrolling:function(){var e=this.$refs,t=e.tableBody,r=e.leftContainer,i=e.rightContainer,o=t?t.$el:null;o&&(r&&_tools.DomTools[0<o.scrollLeft?"addClass":"removeClass"](r,"scrolling--middle"),i&&_tools.DomTools[o.clientWidth<o.scrollWidth-Math.ceil(o.scrollLeft)?"addClass":"removeClass"](i,"scrolling--middle"))},preventEvent:function(t,e,r,i,o){var l,n=this;return _vXETable.default.interceptor.get(e).some(function(e){return!1===e(Object.assign({$grid:n.$xegrid,$table:n,$event:t},r),t,n)})||i&&(l=i()),o&&o(),l},handleGlobalMousedownEvent:function(i){var o=this,l=this.$el,e=this.$refs,t=this.mouseConfig,r=this.mouseOpts,n=this.editStore,s=this.ctxMenuStore,a=this.editOpts,c=this.filterStore,h=this.getRowNode,u=n.actived,d=e.filterWrapper,f=e.validTip,g=t&&r.checked;d&&(getEventTargetNode(i,l,"vxe-cell--filter").flag||getEventTargetNode(i,d.$el).flag||getEventTargetNode(i,document.body,"vxe-table--ignore-clear").flag||this.preventEvent(i,"event.clearFilter",c.args,this.closeFilter)),u.row?!1!==a.autoClear&&(f&&getEventTargetNode(i,f.$el).flag||(!this.lastCallTime||this.lastCallTime+50<Date.now())&&(getEventTargetNode(i,document.body,"vxe-table--ignore-clear").flag||this.preventEvent(i,"event.clearActived",u.args,function(){var e;if("row"===a.mode){var t=getEventTargetNode(i,l,"vxe-body--row");e=!!t.flag&&h(t.targetElem).item!==u.args.row}else e=!getEventTargetNode(i,l,"col--edit").flag;if(e||(e=getEventTargetNode(i,l,"vxe-header--row").flag),e||(e=getEventTargetNode(i,l,"vxe-footer--row").flag),!e&&o.height&&!o.overflowY){var r=i.target;hasClass(r,"vxe-table--body-wrapper")&&(e=i.offsetY<r.clientHeight)}!e&&getEventTargetNode(i,l).flag||setTimeout(function(){return o.clearActived(i)})}))):t&&(getEventTargetNode(i,l).flag||getEventTargetNode(i,e.tableWrapper).flag||(g&&(this.clearIndexChecked(),this.clearHeaderChecked(),this.clearChecked()),this.clearSelected(),getEventTargetNode(i,document.body,"vxe-table--ignore-areas-clear").flag||this.preventEvent(i,"event.clearAreas",{},function(){o.clearCellAreas(),o.clearCopyCellArea()}))),s.visible&&this.$refs.ctxWrapper&&!getEventTargetNode(i,this.$refs.ctxWrapper.$el).flag&&this.closeMenu(),this.isActivated=getEventTargetNode(i,(this.$xegrid||this).$el).flag},handleGlobalBlurEvent:function(){this.closeFilter(),this.closeMenu()},handleGlobalMousewheelEvent:function(){this.clostTooltip(),this.closeMenu()},handleGlobalKeydownEvent:function(F){var L=this;this.isActivated&&this.preventEvent(F,"event.keydown",null,function(){var e,t=L.isCtxMenu,r=L.ctxMenuStore,i=L.editStore,o=L.editOpts,l=L.mouseConfig,n=void 0===l?{}:l,s=L.keyboardConfig,a=void 0===s?{}:s,c=L.treeConfig,h=L.treeOpts,u=L.highlightCurrentRow,d=L.currentRow,f=L.bodyCtxMenu,g=i.selected,x=i.actived,v=F.keyCode,p=8===v,w=9===v,m=13===v,C=27===v,R=32===v,b=37===v,T=38===v,E=39===v,_=40===v,y=46===v,k=65===v,S=113===v,U=93===v,D=F.ctrlKey,O=F.shiftKey,$=b||T||E||_;if(t&&r.visible&&(m||R||$))F.preventDefault(),r.showChild&&hasChildrenList(r.selected)?L.moveCtxMenu(F,v,r,"selectChild",37,!1,r.selected.children):L.moveCtxMenu(F,v,r,"selected",39,!0,L.ctxMenuList);else if(a&&L.mouseConfig&&L.mouseOpts.area&&L.handleKeyboardEvent)L.handleKeyboardEvent(F);else if(R&&(a.isArrow||a.isTab)&&g.row&&g.column&&("checkbox"===g.column.type||"selection"===g.column.type||"radio"===g.column.type))F.preventDefault(),"checkbox"===g.column.type||"selection"===g.column.type?L.handleToggleCheckRowEvent(F,g.args):L.triggerRadioRowEvent(F,g.args);else if(C)L.closeMenu(),L.closeFilter(),x.row&&(e=x.args,L.clearActived(F),n.selected&&L.$nextTick(function(){return L.handleSelected(e,F)}));else if(S)g.row&&g.column&&(F.preventDefault(),L.handleActived(g.args,F));else if(U)L._keyCtx=g.row&&g.column&&f.length,clearTimeout(L.keyCtxTimeout),L.keyCtxTimeout=setTimeout(function(){L._keyCtx=!1},1e3);else if(m&&a.isEnter&&(g.row||x.row||c&&u&&d)){if(D)x.row&&(e=x.args,L.clearActived(F),n.selected&&L.$nextTick(function(){return L.handleSelected(e,F)}));else if(g.row||x.row)O?a.enterToTab?L.moveTabSelected(g.args,O,F):L.moveSelected(g.row?g.args:x.args,b,!0,E,!1,F):a.enterToTab?L.moveTabSelected(g.args,O,F):L.moveSelected(g.row?g.args:x.args,b,!1,E,!0,F);else if(c&&u&&d){var A=d[h.children];if(A&&A.length){F.preventDefault();var M=A[0];e={$table:L,row:M},L.setTreeExpand(d,!0).then(function(){return L.scrollToRow(M)}).then(function(){return L.triggerCurrentRowEvent(F,e)})}}}else if($&&a.isArrow)g.row&&g.column?L.moveSelected(g.args,b,T,E,_,F):(T||_)&&u&&L.moveCurrentRow(T,_,F);else if(w&&a.isTab)g.row||g.column?L.moveTabSelected(g.args,O,F):(x.row||x.column)&&L.moveTabSelected(x.args,O,F);else if(y||(c&&u&&d?p&&a.isArrow:p)){if(a.isDel&&(g.row||g.column))setCellValue(g.row,g.column,null),p&&L.handleActived(g.args,F);else if(p&&a.isArrow&&c&&u&&d){var I=_xeUtils.default.findTree(L.afterFullData,function(e){return e===d},h).parent;I&&(F.preventDefault(),e={$table:L,row:I},L.setTreeExpand(I,!1).then(function(){return L.scrollToRow(I)}).then(function(){return L.triggerCurrentRowEvent(F,e)}))}}else a&&D&&k?a.isCut&&L.mouseConfig&&L.mouseOpts.checked&&L.handleAllChecked(F):a.isEdit&&!D&&(R||48<=v&&v<=57||65<=v&&v<=90||96<=v&&v<=111||186<=v&&v<=192||219<=v&&v<=222)&&g.column&&g.row&&g.column.editRender&&(a.editMethod&&!1===a.editMethod(g.args,F)||o.activeMethod&&!o.activeMethod(g.args)||(setCellValue(g.row,g.column,null),L.handleActived(g.args,F)));L.emitEvent("keydown",{},F)})},handleGlobalPasteEvent:function(e){var t=this.isActivated,r=this.keyboardConfig,i=this.mouseConfig,o=this.mouseOpts;t&&(r&&r.isClip&&i&&o.area&&this.handlePasteCellAreaEvent?this.handlePasteCellAreaEvent(e):r&&r.isCut&&i&&o.checked&&this.handlePaste(e))},handleGlobalCopyEvent:function(e){var t=this.isActivated,r=this.keyboardConfig,i=this.mouseConfig,o=this.mouseOpts;t&&(r&&r.isClip&&i&&o.area&&this.handleCopyCellAreaEvent?this.handleCopyCellAreaEvent(e):r&&r.isCut&&i&&o.checked&&this.handleCopyed(!1,e))},handleGlobalCutEvent:function(e){var t=this.isActivated,r=this.keyboardConfig,i=this.mouseConfig,o=this.mouseOpts;t&&(r&&r.isClip&&i&&o.area&&this.handleCutCellAreaEvent?this.handleCutCellAreaEvent(e):r&&r.isCut&&i&&o.checked&&this.handleCopyed(!0,e))},handleGlobalResizeEvent:function(){this.closeMenu(),this.recalculate(!0)},handleTooltipLeaveEvent:function(){var e=this,t=this.tooltipOpts;setTimeout(function(){e.tooltipActive||e.clostTooltip()},t.leaveDelay)},handleTargetEnterEvent:function(){clearTimeout(this.tooltipTimeout),this.tooltipActive=!0,this.clostTooltip()},handleTargetLeaveEvent:function(){var e=this,t=this.tooltipOpts;this.tooltipActive=!1,t.enterable?this.tooltipTimeout=setTimeout(function(){e.$refs.tooltip.isHover||e.clostTooltip()},t.leaveDelay):this.clostTooltip()},triggerHeaderHelpEvent:function(e,t){var r=t.column.titleHelp;if(r.message){var i=this.$refs,o=this.tooltipStore,l=i.tooltip,n=_tools.UtilTools.getFuncText(r.message);this.handleTargetEnterEvent(),o.visible=!0,l&&l.toVisible(e.currentTarget,n)}},triggerHeaderTooltipEvent:function(e,t){var r=this.tooltipStore,i=t.column,o=e.currentTarget;this.handleTargetEnterEvent(),r.column===i&&r.visible||this.handleTooltip(e,o,o,null,t)},triggerBodyTooltipEvent:function(e,t){var r,i,o=this.editConfig,l=this.editOpts,n=this.editStore,s=this.tooltipStore,a=n.actived,c=t.row,h=t.column,u=e.currentTarget;(this.handleTargetEnterEvent(),o&&("row"===l.mode&&a.row===c||a.row===c&&a.column===h))||(s.column===h&&s.row===c&&s.visible||(h.treeNode?(r=u.querySelector(".vxe-tree-cell"),"html"===h.type&&(i=u.querySelector(".vxe-cell--html"))):i=u.querySelector("html"===h.type?".vxe-cell--html":".vxe-cell--label"),this.handleTooltip(e,u,r||u.children[0],i,t)))},triggerFooterTooltipEvent:function(e,t){var r=this.tooltipStore,i=t.column,o=e.currentTarget;this.handleTargetEnterEvent(),r.column===i&&r.visible||this.handleTooltip(e,o,o.querySelector(".vxe-cell--item")||o.children[0],null,t)},handleTooltip:function(e,t,r,i,o){o.cell=t;var l=this.$refs,n=this.tooltipOpts,s=this.tooltipStore,a=o.column,c=o.row,h=n.enabled,u=n.contentMethod,d=l.tooltip,f=u?u(o):null,g=u&&!_xeUtils.default.eqNull(f),x=g?f:("html"===a.type?r.innerText:r.textContent).trim(),v=r.scrollWidth>r.clientWidth;return x&&(h||g||v)&&(Object.assign(s,{row:c,column:a,visible:!0}),d&&d.toVisible(v?r:i||r,_tools.UtilTools.formatText(x))),this.$nextTick()},clostTooltip:function(){var e=this.$refs.tooltip;return Object.assign(this.tooltipStore,{row:null,column:null,content:null,visible:!1}),e&&e.close(),this.$nextTick()},isAllCheckboxChecked:function(){return this.isAllSelected},isCheckboxIndeterminate:function(){return this.isIndeterminate},getCheckboxIndeterminateRecords:function(){var e=this.treeConfig,t=this.treeIndeterminates;return e?t.slice(0):[]},handleDefaultSelectionChecked:function(){var t=this.fullDataRowIdData,e=this.checkboxOpts,r=e.checkAll,i=e.checkRowKeys;if(r)this.setAllCheckboxRow(!0);else if(i){var o=[];i.forEach(function(e){t[e]&&o.push(t[e].row)}),this.setCheckboxRow(o,!0)}},setSelection:function(e,t){return _tools.UtilTools.warn("vxe.error.delFunc",["setSelection","setCheckboxRow"]),this.setCheckboxRow(e,t)},setCheckboxRow:function(e,t){var r=this;return e&&!_xeUtils.default.isArray(e)&&(e=[e]),e.forEach(function(e){return r.handleSelectRow({row:e},!!t)}),this.$nextTick()},isCheckedByRow:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["isCheckedByRow","isCheckedByCheckboxRow"]),this.isCheckedByCheckboxRow(e)},isCheckedByCheckboxRow:function(e){var t=this.checkboxOpts.checkField;return t?_xeUtils.default.get(e,t):-1<this.selection.indexOf(e)},handleSelectRow:function(e,r){var i=this,o=e.row,l=this.selection,t=this.afterFullData,n=this.treeConfig,s=this.treeOpts,a=this.treeIndeterminates,c=this.checkboxOpts,h=c.checkField,u=c.checkStrictly,d=c.checkMethod;if(h)if(n&&!u){-1===r?(-1===a.indexOf(o)&&a.push(o),_xeUtils.default.set(o,h,!1)):_xeUtils.default.eachTree([o],function(t){o!==t&&d&&!d({row:t})||(_xeUtils.default.set(t,h,r),_xeUtils.default.remove(a,function(e){return e===t}),i.handleCheckboxReserveRow(o,r))},s);var f=_xeUtils.default.findTree(t,function(e){return e===o},s);if(f&&f.parent){var g,x=d?f.items.filter(function(e){return d({row:e})}):f.items;if(_xeUtils.default.find(f.items,function(e){return-1<a.indexOf(e)}))g=-1;else{var v=f.items.filter(function(e){return _xeUtils.default.get(e,h)});g=v.filter(function(e){return-1<x.indexOf(e)}).length===x.length||!(!v.length&&-1!==r)&&-1}return this.handleSelectRow({row:f.parent},g)}}else d&&!d({row:o})||(_xeUtils.default.set(o,h,r),this.handleCheckboxReserveRow(o,r));else if(n&&!u){-1===r?(-1===a.indexOf(o)&&a.push(o),_xeUtils.default.remove(l,function(e){return e===o})):_xeUtils.default.eachTree([o],function(t){o!==t&&d&&!d({row:t})||(r?l.push(t):_xeUtils.default.remove(l,function(e){return e===t}),_xeUtils.default.remove(a,function(e){return e===t}),i.handleCheckboxReserveRow(o,r))},s);var p=_xeUtils.default.findTree(t,function(e){return e===o},s);if(p&&p.parent){var w,m=d?p.items.filter(function(e){return d({row:e})}):p.items;if(_xeUtils.default.find(p.items,function(e){return-1<a.indexOf(e)}))w=-1;else{var C=p.items.filter(function(e){return-1<l.indexOf(e)});w=C.filter(function(e){return-1<m.indexOf(e)}).length===m.length||!(!C.length&&-1!==r)&&-1}return this.handleSelectRow({row:p.parent},w)}}else d&&!d({row:o})||(r?-1===l.indexOf(o)&&l.push(o):_xeUtils.default.remove(l,function(e){return e===o}),this.handleCheckboxReserveRow(o,r));this.checkSelectionStatus()},handleToggleCheckRowEvent:function(e,t){var r=this.selection,i=this.checkboxOpts.checkField,o=t.row,l=i?!_xeUtils.default.get(o,i):-1===r.indexOf(o);e?this.triggerCheckRowEvent(e,t,l):this.handleSelectRow(t,l)},triggerCheckRowEvent:function(e,t,r){var i=this.checkboxOpts.checkMethod;if(!i||i({row:t.row})){this.handleSelectRow(t,r);var o=this.getCheckboxRecords();this.$listeners["select-change"]?(_tools.UtilTools.warn("vxe.error.delEvent",["select-change","checkbox-change"]),this.emitEvent("select-change",Object.assign({records:o,selection:o,reserves:this.getCheckboxReserveRecords(),checked:r},t),e)):this.emitEvent("checkbox-change",Object.assign({records:o,selection:o,reserves:this.getCheckboxReserveRecords(),indeterminates:this.getCheckboxIndeterminateRecords(),checked:r},t),e)}},toggleRowSelection:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["toggleRowSelection","toggleCheckboxRow"]),this.toggleCheckboxRow(e)},toggleCheckboxRow:function(e){return this.handleToggleCheckRowEvent(null,{row:e}),this.$nextTick()},setAllSelection:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["setAllSelection","setAllCheckboxRow"]),this.setAllCheckboxRow(e)},setAllCheckboxRow:function(t){var r=this,i=this.afterFullData,e=this.treeConfig,o=this.treeOpts,l=this.selection,n=this.checkboxReserveRowMap,s=this.checkboxOpts,a=s.checkField,c=s.reserve,h=s.checkStrictly,u=s.checkMethod,d=[],f=e?[]:l.filter(function(e){return-1===i.indexOf(e)});if(h)this.isAllSelected=t;else{if(a){var g=function(e){u&&!u({row:e})||_xeUtils.default.set(e,a,t)};e?_xeUtils.default.eachTree(i,g,o):i.forEach(g)}else e?t?_xeUtils.default.eachTree(i,function(e){u&&!u({row:e})||d.push(e)},o):u&&_xeUtils.default.eachTree(i,function(e){!u({row:e})&&-1<l.indexOf(e)&&d.push(e)},o):t?d=u?i.filter(function(e){return-1<l.indexOf(e)||u({row:e})}):i.slice(0):u&&(d=i.filter(function(e){return u({row:e})?0:-1<l.indexOf(e)}));c&&(t?d.forEach(function(e){n[getRowid(r,e)]=e}):i.forEach(function(e){return r.handleCheckboxReserveRow(e,!1)})),this.selection=f.concat(d)}this.treeIndeterminates=[],this.checkSelectionStatus()},checkSelectionStatus:function(){var e=this.afterFullData,t=this.selection,r=this.treeIndeterminates,i=this.checkboxOpts,o=this.treeConfig,l=i.checkField,n=i.halfField,s=i.checkStrictly,a=i.checkMethod;if(!s){var c=!1,h=!1;h=l?(c=e.length&&e.every(a?function(e){return!a({row:e})||_xeUtils.default.get(e,l)}:function(e){return _xeUtils.default.get(e,l)}),o?n?!c&&e.some(function(e){return _xeUtils.default.get(e,l)||_xeUtils.default.get(e,n)||-1<r.indexOf(e)}):!c&&e.some(function(e){return _xeUtils.default.get(e,l)||-1<r.indexOf(e)}):n?!c&&e.some(function(e){return _xeUtils.default.get(e,l)||_xeUtils.default.get(e,n)}):!c&&e.some(function(e){return _xeUtils.default.get(e,l)})):(c=e.length&&e.every(a?function(e){return!a({row:e})||-1<t.indexOf(e)}:function(e){return-1<t.indexOf(e)}),o?!c&&e.some(function(e){return-1<r.indexOf(e)||-1<t.indexOf(e)}):!c&&e.some(function(e){return-1<t.indexOf(e)})),this.isAllSelected=c,this.isIndeterminate=h}},handleReserveStatus:function(){var e=this.expandColumn,t=this.treeOpts,r=this.treeConfig,i=this.fullDataRowIdData,o=this.fullAllDataRowMap,l=this.currentRow,n=this.selectRow,s=this.radioReserveRow,a=this.radioOpts,c=this.checkboxOpts,h=this.selection,u=this.rowExpandeds,d=this.treeExpandeds,f=this.expandOpts;if(n&&!o.has(n)&&(this.selectRow=null),a.reserve&&s){var g=getRowid(this,s);i[g]&&this.setRadioRow(i[g].row)}this.selection=getRecoverRow(this,h),c.reserve&&this.setCheckboxRow(handleReserveRow(this,this.checkboxReserveRowMap),!0),l&&!o.has(l)&&(this.currentRow=null),this.rowExpandeds=e?getRecoverRow(this,u):[],e&&f.reserve&&this.setRowExpand(handleReserveRow(this,this.rowExpandedReserveRowMap),!0),this.treeExpandeds=r?getRecoverRow(this,d):[],r&&t.reserve&&this.setTreeExpand(handleReserveRow(this,this.treeExpandedReserveRowMap),!0)},getRadioReserveRecord:function(){var e=this.fullDataRowIdData,t=this.radioReserveRow;return this.radioOpts.reserve&&t&&!e[getRowid(this,t)]?t:null},clearRadioReserve:function(){return this.radioReserveRow=null,this.$nextTick()},handleRadioReserveRow:function(e){this.radioOpts.reserve&&(this.radioReserveRow=e)},getSelectReserveRecords:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["getSelectReserveRecords","getCheckboxReserveRecords"]),this.getCheckboxReserveRecords()},getCheckboxReserveRecords:function(){var t=this.fullDataRowIdData,r=this.checkboxReserveRowMap,e=this.checkboxOpts,i=[];return e.reserve&&Object.keys(r).forEach(function(e){t[e]||i.push(r[e])}),i},clearSelectReserve:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["clearSelectReserve","clearCheckboxReserve"]),this.clearCheckboxReserve()},clearCheckboxReserve:function(){return this.checkboxReserveRowMap={},this.$nextTick()},handleCheckboxReserveRow:function(e,t){var r=this.checkboxReserveRowMap;if(this.checkboxOpts.reserve){var i=getRowid(this,e);t?r[i]=e:r[i]&&delete r[i]}},triggerCheckAllEvent:function(e,t){this.setAllCheckboxRow(t);var r=this.getCheckboxRecords();this.$listeners["select-all"]?(_tools.UtilTools.warn("vxe.error.delEvent",["select-all","checkbox-all"]),this.emitEvent("select-all",{records:r,selection:r,reserves:this.getCheckboxReserveRecords(),checked:t},e)):this.emitEvent("checkbox-all",{records:r,selection:r,reserves:this.getCheckboxReserveRecords(),indeterminates:this.getCheckboxIndeterminateRecords(),checked:t},e)},toggleAllSelection:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["toggleAllSelection","toggleAllCheckboxRow"]),this.toggleAllCheckboxRow()},toggleAllCheckboxRow:function(){return this.triggerCheckAllEvent(null,!this.isAllSelected),this.$nextTick()},clearSelection:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["clearSelection","clearCheckboxRow"]),this.clearCheckboxRow()},clearCheckboxRow:function(){var t=this,e=this.tableFullData,r=this.treeConfig,i=this.treeOpts,o=this.checkboxOpts,l=o.checkField,n=o.reserve;return l&&(r?_xeUtils.default.eachTree(e,function(e){return _xeUtils.default.set(e,l,!1)},i):e.forEach(function(e){return _xeUtils.default.set(e,l,!1)})),n&&e.forEach(function(e){return t.handleCheckboxReserveRow(e,!1)}),this.isAllSelected=!1,this.isIndeterminate=!1,this.selection=[],this.treeIndeterminates=[],this.$nextTick()},handleDefaultRadioChecked:function(){var e=this.radioOpts,t=this.fullDataRowIdData,r=e.checkRowKey,i=e.reserve;if(r&&(t[r]&&this.setRadioRow(t[r].row),i)){var o=getRowkey(this);this.radioReserveRow=_defineProperty({},o,r)}},triggerRadioRowEvent:function(e,t){var r=this.selectRow!==t.row;this.setRadioRow(t.row),r&&this.emitEvent("radio-change",t,e)},triggerCurrentRowEvent:function(e,t){var r=this.currentRow!==t.row;this.setCurrentRow(t.row),r&&this.emitEvent("current-change",t,e)},setCurrentRow:function(e){return this.clearCurrentRow(),this.clearCurrentColumn(),this.currentRow=e,this.highlightCurrentRow&&_xeUtils.default.arrayEach(this.$el.querySelectorAll('[data-rowid="'.concat(getRowid(this,e),'"]')),function(e){return addClass(e,"row--current")}),this.$nextTick()},isCheckedByRadioRow:function(e){return this.selectRow===e},setRadioRow:function(e){var t=this.radioOpts.checkMethod;return!e||t&&!t({row:e})||(this.selectRow=e,this.handleRadioReserveRow(e)),this.$nextTick()},clearCurrentRow:function(){return this.currentRow=null,this.hoverRow=null,_xeUtils.default.arrayEach(this.$el.querySelectorAll(".row--current"),function(e){return removeClass(e,"row--current")}),this.$nextTick()},clearRadioRow:function(){return this.selectRow=null,this.$nextTick()},getCurrentRow:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["getCurrentRow","getCurrentRecord"]),this.getCurrentRecord()},getCurrentRecord:function(){return this.highlightCurrentRow?this.currentRow:null},getRadioRow:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["getRadioRow","getRadioRecord"]),this.getRadioRecord()},getRadioRecord:function(){return this.selectRow},triggerHoverEvent:function(e,t){var r=t.row;this.setHoverRow(r)},setHoverRow:function(e){var t=getRowid(this,e);this.clearHoverRow(),_xeUtils.default.arrayEach(this.$el.querySelectorAll('[data-rowid="'.concat(t,'"]')),function(e){return addClass(e,"row--hover")}),this.hoverRow=e},clearHoverRow:function(){_xeUtils.default.arrayEach(this.$el.querySelectorAll(".vxe-body--row.row--hover"),function(e){return removeClass(e,"row--hover")}),this.hoverRow=null},triggerHeaderCellClickEvent:function(e,t){var r=this._lastResizeTime,i=this.sortOpts,o=t.column,l=e.currentTarget,n=r&&r>Date.now()-300,s=getEventTargetNode(e,l,"vxe-cell--sort").flag,a=getEventTargetNode(e,l,"vxe-cell--filter").flag;return"cell"!==i.trigger||n||s||a||this.triggerSortEvent(e,o,getNextSortOrder(this,o)),this.emitEvent("header-cell-click",Object.assign({triggerResizable:n,triggerSort:s,triggerFilter:a,cell:l},t),e),this.highlightCurrentColumn?this.setCurrentColumn(o):this.$nextTick()},triggerHeaderCellDBLClickEvent:function(e,t){this.emitEvent("header-cell-dblclick",Object.assign({cell:e.currentTarget},t),e)},getCurrentColumn:function(){return this.highlightCurrentColumn?this.currentColumn:null},setCurrentColumn:function(e){return this.clearCurrentRow(),this.clearCurrentColumn(),this.currentColumn=e,this.$nextTick()},clearCurrentColumn:function(){return this.currentColumn=null,this.$nextTick()},checkValidate:function(e){return _vXETable.default._valid?this.triggerValidate(e):this.$nextTick()},handleChangeCell:function(e,t){var r=this;this.checkValidate("blur").catch(function(e){return e}).then(function(){r.handleActived(t,e).then(function(){return r.checkValidate("change")}).catch(function(e){return e})})},triggerCellClickEvent:function(e,t){var r=this.highlightCurrentRow,i=this.editStore,o=this.radioOpts,l=this.expandOpts,n=this.treeOpts,s=this.editConfig,a=this.editOpts,c=this.checkboxOpts,h=this.mouseConfig,u=this.mouseOpts,d=i.actived,f=t,g=f.row,x=f.column,v=x.type,p=x.treeNode,w="radio"===v,m="checkbox"===v||"selection"===v,C="expand"===v,R=e.currentTarget,b=w&&getEventTargetNode(e,R,"vxe-cell--radio").flag,T=m&&getEventTargetNode(e,R,"vxe-cell--checkbox").flag,E=p&&getEventTargetNode(e,R,"vxe-tree--btn-wrapper").flag,_=C&&getEventTargetNode(e,R,"vxe-table--expanded").flag;t=Object.assign({cell:R,triggerRadio:b,triggerCheckbox:T,triggerTreeNode:E,triggerExpandNode:_},t);var y=h&&u.checked;!_&&("row"===l.trigger||C&&"cell"===l.trigger)&&this.triggerRowExpandEvent(e,t),("row"===n.trigger||p&&"cell"===n.trigger)&&this.triggerTreeExpandEvent(e,t),E||(_||(r&&(T||b||this.triggerCurrentRowEvent(e,t)),!b&&("row"===o.trigger||w&&"cell"===o.trigger)&&this.triggerRadioRowEvent(e,t),!T&&("row"===c.trigger||m&&"cell"===c.trigger)&&this.handleToggleCheckRowEvent(e,t)),y||s&&("manual"===a.trigger?d.args&&d.row===g&&x!==d.column&&this.handleChangeCell(e,t):d.args&&g===d.row&&x===d.column||("click"===a.trigger?this.handleChangeCell(e,t):"dblclick"===a.trigger&&"row"===a.mode&&d.row===g&&this.handleChangeCell(e,t)))),this.emitEvent("cell-click",t,e)},triggerCellDBLClickEvent:function(e,t){var r=this,i=this.editStore,o=this.editConfig,l=this.editOpts,n=i.actived,s=e.currentTarget;t.cell=s,o&&"dblclick"===l.trigger&&(n.args&&e.currentTarget===n.args.cell||("row"===l.mode?this.checkValidate("blur").catch(function(e){return e}).then(function(){r.handleActived(t,e).then(function(){return r.checkValidate("change")}).catch(function(e){return e})}):"cell"===l.mode&&this.handleActived(t,e).then(function(){return r.checkValidate("change")}).catch(function(e){return e}))),this.emitEvent("cell-dblclick",t,e)},handleDefaultSort:function(){var e=this.sortOpts.defaultSort;if(e){var t=e.field,r=e.order;if(t&&r){var i=_xeUtils.default.find(this.visibleColumn,function(e){return e.property===t});i&&!i.order&&this.sort(t,r)}}},triggerSortEvent:function(e,t,r){var i=t.property;if(t.sortable||t.remoteSort){var o={column:t,property:i,field:i,prop:i,order:r,sortBy:t.sortBy,$table:this,$event:e};r&&t.order!==r?this.sort(i,r):(o.order=null,this.clearSort()),this.emitEvent("sort-change",o,e)}},sort:function(e,t){var r=this.tableFullColumn,i=this.sortOpts,o=this.getColumnByField(e);if(o){var l=_xeUtils.default.isBoolean(o.remoteSort)?o.remoteSort:i.remote;if(o.sortable||o.remoteSort)return arguments.length<=1&&(t=getNextSortOrder(this,o)),o.order!==t&&(r.forEach(function(e){e.order=null}),o.order=t,l||this.handleTableData(!0)),this.$nextTick().then(this.updateStyle)}return this.$nextTick()},clearSort:function(){return this.tableFullColumn.forEach(function(e){e.order=null}),this.handleTableData(!0)},getSortColumn:function(){return _xeUtils.default.find(this.visibleColumn,function(e){return e.sortable&&e.order})},closeFilter:function(){return Object.assign(this.filterStore,{isAllSelected:!1,isIndeterminate:!1,options:[],visible:!1}),this.$nextTick()},isFilter:function(e){if(e){var t=this.getColumnByField(e);return t&&t.filters&&t.filters.some(function(e){return e.checked})}return this.visibleColumn.some(function(e){return e.filters&&e.filters.some(function(e){return e.checked})})},isRowExpandLoaded:function(e){var t=this.fullAllDataRowMap.get(e);return t&&t.expandLoaded},clearRowExpandLoaded:function(t){var e=this.expandOpts,r=this.expandLazyLoadeds,i=this.fullAllDataRowMap,o=e.lazy,l=i.get(t);return o&&l&&(l.expandLoaded=!1,_xeUtils.default.remove(r,function(e){return t===e})),this.$nextTick()},reloadExpandContent:function(e){var t=this,r=this.expandOpts,i=this.expandLazyLoadeds;return r.lazy&&-1===i.indexOf(e)&&this.clearRowExpandLoaded(e).then(function(){return t.handleAsyncRowExpand(e)}),this.$nextTick()},triggerRowExpandEvent:function(e,t){var r=this.$listeners,i=this.expandOpts,o=this.expandLazyLoadeds,l=this.expandColumn,n=t.row;if(!i.lazy||-1===o.indexOf(n)){var s=!this.isExpandByRow(n),a=this.getColumnIndex(l),c=this.$getColumnIndex(l);this.setRowExpand(n,s),r["toggle-expand-change"]?(_tools.UtilTools.warn("vxe.error.delEvent",["toggle-expand-change","toggle-row-expand"]),this.emitEvent("toggle-expand-change",{expanded:s,column:l,columnIndex:a,$columnIndex:c,row:n,rowIndex:this.getRowIndex(n),$rowIndex:this.$getRowIndex(n)},e)):this.emitEvent("toggle-row-expand",{expanded:s,column:l,columnIndex:a,$columnIndex:c,row:n,rowIndex:this.getRowIndex(n),$rowIndex:this.$getRowIndex(n)},e)}},toggleRowExpansion:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["toggleRowExpansion","toggleRowExpand"]),this.toggleRowExpand(e)},toggleRowExpand:function(e){return this.setRowExpand(e,!this.isExpandByRow(e))},handleDefaultRowExpand:function(){var e=this.expandOpts,t=this.fullDataRowIdData,r=e.expandAll,i=e.expandRowKeys;if(r)this.setAllRowExpand(!0);else if(i){var o=[];i.forEach(function(e){t[e]&&o.push(t[e].row)}),this.setRowExpand(o,!0)}},setAllRowExpansion:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["setAllRowExpansion","setAllRowExpand"]),this.setAllRowExpand(e)},setAllRowExpand:function(e){return this.setRowExpand(this.expandOpts.lazy?this.tableData:this.tableFullData,e)},handleAsyncRowExpand:function(t){var r=this,i=this.fullAllDataRowMap.get(t);return new Promise(function(e){r.expandLazyLoadeds.push(t),r.expandOpts.loadMethod({$table:r,row:t,rowIndex:r.getRowIndex(t),$rowIndex:r.$getRowIndex(t)}).catch(function(e){return e}).then(function(){i.expandLoaded=!0,_xeUtils.default.remove(r.expandLazyLoadeds,function(e){return e===t}),r.rowExpandeds.push(t),e(r.$nextTick().then(r.recalculate))})})},setRowExpansion:function(e,t){return _tools.UtilTools.warn("vxe.error.delFunc",["setRowExpansion","setRowExpand"]),this.setRowExpand(e,t)},setRowExpand:function(e,t){var r=this,i=this.fullAllDataRowMap,o=this.expandLazyLoadeds,l=this.expandOpts,n=this.expandColumn,s=this.rowExpandeds,a=l.reserve,c=l.lazy,h=l.accordion,u=l.toggleMethod,d=[],f=this.getColumnIndex(n),g=this.$getColumnIndex(n);if(e){_xeUtils.default.isArray(e)||(e=[e]),h&&(s=[],e=e.slice(e.length-1,e.length));var x=u?e.filter(function(e){return u({expanded:t,column:n,columnIndex:f,$columnIndex:g,row:e,rowIndex:r.getRowIndex(e),$rowIndex:r.$getRowIndex(e)})}):e;t?x.forEach(function(e){if(-1===s.indexOf(e)){var t=i.get(e);c&&!t.expandLoaded&&-1===o.indexOf(e)?d.push(r.handleAsyncRowExpand(e)):s.push(e)}}):_xeUtils.default.remove(s,function(e){return-1<x.indexOf(e)}),a&&x.forEach(function(e){return r.handleRowExpandReserve(e,t)})}return this.rowExpandeds=s,Promise.all(d).then(this.recalculate)},hasRowExpand:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["hasRowExpand","isExpandByRow"]),this.isExpandByRow(e)},isExpandByRow:function(e){return-1<this.rowExpandeds.indexOf(e)},clearRowExpand:function(){var t=this,e=this.expandOpts,r=this.rowExpandeds,i=this.tableFullData,o=e.reserve,l=r.length;return this.rowExpandeds=[],o&&i.forEach(function(e){return t.handleRowExpandReserve(e,!1)}),this.$nextTick().then(function(){l&&t.recalculate()})},clearRowExpandReserve:function(){return this.rowExpandedReserveRowMap={},this.$nextTick()},handleRowExpandReserve:function(e,t){var r=this.rowExpandedReserveRowMap;if(this.expandOpts.reserve){var i=getRowid(this,e);t?r[i]=e:r[i]&&delete r[i]}},getRowExpandRecords:function(){return this.rowExpandeds.slice(0)},getTreeExpandRecords:function(){return this.treeExpandeds.slice(0)},getTreeStatus:function(){return this.treeConfig?{config:this.treeOpts,rowExpandeds:this.getTreeExpandRecords()}:null},isTreeExpandLoaded:function(e){var t=this.fullAllDataRowMap.get(e);return t&&t.treeLoaded},clearTreeExpandLoaded:function(t){var e=this.treeOpts,r=this.treeExpandeds,i=this.fullAllDataRowMap,o=e.lazy,l=i.get(t);return o&&l&&(l.treeLoaded=!1,_xeUtils.default.remove(r,function(e){return t===e})),this.$nextTick()},reloadTreeChilds:function(e){var t=this,r=this.treeOpts,i=this.treeLazyLoadeds,o=r.lazy,l=r.hasChild;return o&&e[l]&&-1===i.indexOf(e)&&this.clearTreeExpandLoaded(e).then(function(){return t.handleAsyncTreeExpandChilds(e)}),this.$nextTick()},triggerTreeExpandEvent:function(e,t){var r=this.$listeners,i=this.treeOpts,o=this.treeLazyLoadeds,l=t.row,n=t.column;if(!i.lazy||-1===o.indexOf(l)){var s=!this.isTreeExpandByRow(l),a=this.getColumnIndex(n),c=this.$getColumnIndex(n);this.setTreeExpand(l,s),r["toggle-tree-change"]?(_tools.UtilTools.warn("vxe.error.delEvent",["toggle-tree-change","toggle-tree-expand"]),this.emitEvent("toggle-tree-change",{expanded:s,column:n,columnIndex:a,$columnIndex:c,row:l},e)):this.emitEvent("toggle-tree-expand",{expanded:s,column:n,columnIndex:a,$columnIndex:c,row:l},e)}},toggleTreeExpansion:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["toggleTreeExpansion","toggleTreeExpand"]),this.toggleTreeExpand(e)},toggleTreeExpand:function(e){return this.setTreeExpand(e,!this.isTreeExpandByRow(e))},handleDefaultTreeExpand:function(){var e=this.treeConfig,r=this.treeOpts,i=this.tableFullData;if(e){var t=r.expandAll,o=r.expandRowKeys;if(t)this.setAllTreeExpand(!0);else if(o){var l=[],n=getRowkey(this);o.forEach(function(t){var e=_xeUtils.default.findTree(i,function(e){return t===_xeUtils.default.get(e,n)},r);e&&l.push(e.item)}),this.setTreeExpand(l,!0)}}},handleAsyncTreeExpandChilds:function(r){var i=this,e=this.fullAllDataRowMap,o=this.treeExpandeds,t=this.treeOpts,l=this.treeLazyLoadeds,n=this.checkboxOpts,s=t.loadMethod,a=t.children,c=n.checkStrictly,h=e.get(r);return new Promise(function(t){l.push(r),s({$table:i,row:r}).catch(function(){return[]}).then(function(e){h.treeLoaded=!0,_xeUtils.default.remove(l,function(e){return e===r}),_xeUtils.default.isArray(e)||(e=[]),e&&(r[a]=e,i.appendTreeCache(r,e),e.length&&-1===o.indexOf(r)&&o.push(r),!c&&i.isCheckedByCheckboxRow(r)&&i.setCheckboxRow(e,!0)),t(i.$nextTick().then(i.recalculate))})})},setAllTreeExpansion:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["setAllTreeExpansion","setAllTreeExpand"]),this.setAllTreeExpand(e)},setAllTreeExpand:function(e){var t=this.tableFullData,r=this.treeOpts,i=r.lazy,o=r.children,l=[];return _xeUtils.default.eachTree(t,function(e){var t=e[o];(i||t&&t.length)&&l.push(e)},r),this.setTreeExpand(l,e)},setTreeExpansion:function(e,t){return _tools.UtilTools.warn("vxe.error.delFunc",["setTreeExpansion","setTreeExpand"]),this.setTreeExpand(e,t)},setTreeExpand:function(t,r){var i=this,o=this.fullAllDataRowMap,e=this.tableFullData,l=this.treeExpandeds,n=this.treeOpts,s=this.treeLazyLoadeds,a=this.treeNodeColumn,c=n.reserve,h=n.lazy,u=n.hasChild,d=n.children,f=n.accordion,g=n.toggleMethod,x=[],v=this.getColumnIndex(a),p=this.$getColumnIndex(a);if(t&&(_xeUtils.default.isArray(t)||(t=[t]),t.length)){if(f){t=t.slice(t.length-1,t.length);var w=_xeUtils.default.findTree(e,function(e){return e===t[0]},n);_xeUtils.default.remove(l,function(e){return-1<w.items.indexOf(e)})}var m=g?t.filter(function(e){return g({expanded:r,column:a,columnIndex:v,$columnIndex:p,row:e})}):t;return r?m.forEach(function(e){if(-1===l.indexOf(e)){var t=o.get(e);h&&e[u]&&!t.treeLoaded&&-1===s.indexOf(e)?x.push(i.handleAsyncTreeExpandChilds(e)):e[d]&&e[d].length&&l.push(e)}}):_xeUtils.default.remove(l,function(e){return-1<m.indexOf(e)}),c&&m.forEach(function(e){return i.handleTreeExpandReserve(e,r)}),Promise.all(x).then(this.recalculate)}return Promise.resolve()},hasTreeExpand:function(e){return _tools.UtilTools.warn("vxe.error.delFunc",["hasTreeExpand","isTreeExpandByRow"]),this.isTreeExpandByRow(e)},isTreeExpandByRow:function(e){return-1<this.treeExpandeds.indexOf(e)},clearTreeExpand:function(){var t=this,e=this.treeOpts,r=this.treeExpandeds,i=this.tableFullData,o=e.reserve,l=r.length;return this.treeExpandeds=[],o&&_xeUtils.default.eachTree(i,function(e){return t.handleTreeExpandReserve(e,!1)},e),this.$nextTick().then(function(){l&&t.recalculate()})},clearTreeExpandReserve:function(){return this.treeExpandedReserveRowMap={},this.$nextTick()},handleTreeExpandReserve:function(e,t){var r=this.treeExpandedReserveRowMap;if(this.treeOpts.reserve){var i=getRowid(this,e);t?r[i]=e:r[i]&&delete r[i]}},getVirtualScroller:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["getVirtualScroller","getScroll"]),this.getScroll()},getTableScroll:function(){return _tools.UtilTools.warn("vxe.error.delFunc",["getTableScroll","getScroll"]),this.getScroll()},getScroll:function(){var e=this.$refs,t=this.scrollXLoad,r=this.scrollYLoad,i=e.tableBody.$el;return{virtualX:t,virtualY:r,scrollTop:i.scrollTop,scrollLeft:i.scrollLeft}},triggerScrollXEvent:function(){this.loadScrollXData()},loadScrollXData:function(e){for(var t=this.$refs,r=this.visibleColumn,i=this.scrollXStore,o=i.startIndex,l=i.renderSize,n=i.offsetSize,s=i.visibleSize,a=t.tableBody.$el.scrollLeft,c=0,h=0,u=e||!1,d=r.length,f=0;f<d;f++)if(a<(h+=r[f].renderWidth)){c=f;break}if(e||i.visibleIndex!==c){var g=Math.min(Math.floor((l-s)/2),s);i.visibleIndex===c?i.startIndex=c:i.visibleIndex>c?(u=c-n<=o)&&(i.startIndex=Math.max(0,Math.max(0,c-g))):(u=o+l<=c+s+n)&&(i.startIndex=Math.max(0,Math.min(r.length-l,c-g))),u&&this.updateScrollXData(),i.visibleIndex=c}this.clostTooltip()},triggerScrollYEvent:function(e){isWebkit&&this.scrollYStore.adaptive?this.loadScrollYData(e):this.debounceScrollY(e)},debounceScrollY:_xeUtils.default.debounce(function(e){this.loadScrollYData(e)},debounceScrollYDuration,{leading:!1,trailing:!0}),loadScrollYData:function(e){var t=this.afterFullData,r=this.scrollYStore,i=this.isLoadData,o=r.startIndex,l=r.renderSize,n=r.offsetSize,s=r.visibleSize,a=r.rowHeight,c=e.target.scrollTop,h=Math.ceil(c/a),u=!1;if(i||r.visibleIndex!==h){var d=Math.min(Math.floor((l-s)/2),s);r.visibleIndex>h?(u=h-n<=o)&&(r.startIndex=Math.max(0,h-Math.max(d,l-s))):(u=o+l<=h+s+n)&&(r.startIndex=Math.max(0,Math.min(t.length-l,h-d))),u&&this.updateScrollYData(),r.visibleIndex=h,this.isLoadData=!1}},computeRowHeight:function(){var e,t=this.$refs.tableBody,r=t?t.$el:null,i=this.$refs.tableHeader;if(r){var o=r.querySelector("tbody>tr");!o&&i&&(o=i.$el.querySelector("thead>tr")),o&&(e=o.clientHeight)}e||(e=this.rowHeightMaps[this.vSize||"default"]),this.rowHeight=e},computeScrollLoad:function(){var C=this;return this.$nextTick().then(function(){var e=C.vSize,t=C.scrollXLoad,r=C.scrollYLoad,i=C.sYOpts,o=C.scrollYStore,l=C.sXOpts,n=C.scrollXStore,s=C.visibleColumn,a=C.rowHeightMaps,c=C.$refs.tableBody,h=c?c.$el:null,u=C.$refs.tableHeader;if(h){if(t){var d=h.clientWidth,f=_xeUtils.default.toNumber(l.vSize);if(!l.vSize)for(var g=f=s.length,x=0,v=0;v<g;v++)if(d<(x+=s[v].renderWidth)){f=v+1;break}n.visibleSize=f,l.oSize||(n.offsetSize=f),l.rSize||(n.renderSize=Math.max(8,f+6)),C.updateScrollXData()}else C.updateScrollXSpace();if(r){var p;if(i.rHeight)p=i.rHeight;else{var w=h.querySelector("tbody>tr");!w&&u&&(w=u.$el.querySelector("thead>tr")),w&&(p=w.clientHeight)}p||(p=a[e||"default"]);var m=_xeUtils.default.toNumber(i.vSize||Math.ceil(h.clientHeight/p));o.visibleSize=m,o.rowHeight=p,i.oSize||(o.offsetSize=m),i.rSize||(o.renderSize=Math.max(6,browse.edge?10*m:isWebkit?m+2:6*m)),C.updateScrollYData()}else C.updateScrollYSpace()}C.$nextTick(C.updateStyle)})},updateScrollXData:function(){var e=this.visibleColumn,t=this.scrollXStore;this.tableColumn=e.slice(t.startIndex,t.startIndex+t.renderSize),this.updateScrollXSpace()},updateScrollXSpace:function(){var e=this.$refs,i=this.elemStore,t=this.visibleColumn,r=this.scrollXStore,o=this.scrollXLoad,l=this.tableWidth,n=this.scrollbarWidth,s=e.tableHeader,a=e.tableBody,c=e.tableFooter,h=s?s.$el.querySelector(".vxe-table--header"):null,u=a.$el.querySelector(".vxe-table--body"),d=c?c.$el.querySelector(".vxe-table--footer"):null,f=t.slice(0,r.startIndex).reduce(function(e,t){return e+t.renderWidth},0),g="";o&&(g="".concat(f,"px")),h&&(h.style.marginLeft=g),u.style.marginLeft=g,d&&(d.style.marginLeft=g);["main"].forEach(function(r){["header","body","footer"].forEach(function(e){var t=i["".concat(r,"-").concat(e,"-xSpace")];t&&(t.style.width=o?"".concat(l+("header"===e?n:0),"px"):"")})}),this.$nextTick(this.updateStyle)},updateScrollYData:function(){this.handleTableData(),this.updateScrollYSpace()},updateScrollYSpace:function(){var i=this.elemStore,e=this.scrollYStore,t=this.scrollYLoad,r=this.afterFullData.length*e.rowHeight,o=Math.max(e.startIndex*e.rowHeight,0),l="",n="";t&&(l="".concat(o,"px"),n="".concat(r,"px")),["main","left","right"].forEach(function(r){var e=i["".concat(r,"-body-table")];e&&(e.style.marginTop=l),["header","body","footer"].forEach(function(e){var t=i["".concat(r,"-").concat(e,"-ySpace")];t&&(t.style.height=n)})}),this.$nextTick(this.updateStyle)},scrollTo:function(e,t){var r=this,i=this.$refs,o=i.tableBody,l=i.rightBody,n=i.tableFooter,s=o?o.$el:null,a=(l?l.$el:null)||s,c=(n?n.$el:null)||s;return _xeUtils.default.isNumber(e)&&(c.scrollLeft=e),_xeUtils.default.isNumber(t)&&(a.scrollTop=t),this.scrollXLoad||this.scrollYLoad?new Promise(function(e){return setTimeout(function(){return e(r.$nextTick())},50)}):this.$nextTick()},scrollToRow:function(e,t){var r=[];return e&&(this.treeConfig?r.push(this.scrollToTreeRow(e)):r.push(_tools.DomTools.rowToVisible(this,e))),r.push(this.scrollToColumn(t)),Promise.all(r)},scrollToColumn:function(e){return e&&this.fullColumnMap.has(e)?_tools.DomTools.colToVisible(this,e):this.$nextTick()},scrollToTreeRow:function(t){var r=this,e=this.tableFullData,i=this.treeConfig,o=this.treeOpts;if(i){var l=_xeUtils.default.findTree(e,function(e){return e===t},o);if(l){var n=l.nodes;n.forEach(function(e,t){t<n.length-1&&!r.isTreeExpandByRow(e)&&r.setTreeExpand(e,!0)})}}return this.$nextTick()},clearScroll:function(){var t=this,e=this.$refs,r=e.tableBody,i=e.rightBody,o=e.tableFooter,l=r?r.$el:null,n=(i?i.$el:null)||l,s=(o?o.$el:null)||l;return n&&(n.scrollTop=0),s&&(s.scrollLeft=0),new Promise(function(e){return setTimeout(function(){return e(t.$nextTick())})})},updateFooter:function(){var e=this.showFooter,t=this.visibleColumn,r=this.footerMethod;return e&&r&&(this.footerData=t.length?r({columns:t,data:this.afterFullData,$table:this,$grid:this.$xegrid}):[]),this.$nextTick()},updateStatus:function(n,s){var a=this,c=!_xeUtils.default.isUndefined(s);return this.$nextTick().then(function(){var e=a.$refs,t=a.editRules,r=a.validStore;if(n&&e.tableBody&&t){var i=n.row,o=n.column;if(a.hasCellRules("change",i,o)){var l=a.getCell(i,o);if(l)return a.validCellRules("change",i,o,s).then(function(){c&&r.visible&&setCellValue(i,o,s),a.clearValidate()}).catch(function(e){var t=e.rule;c&&setCellValue(i,o,s),a.showValidTooltip({rule:t,row:i,column:o,cell:l})})}}})},handleDefaultMergeCells:function(){this.setMergeCells(this.mergeCells)},setMergeCells:function(e){var t=this;return this.spanMethod&&_tools.UtilTools.error("vxe.error.errConflicts",["merge-cells","span-method"]),setMerges(this,e,this.mergeList,this.afterFullData),this.$nextTick().then(function(){return t.updateCellAreas()})},removeMergeCells:function(e){var t=this;this.spanMethod&&_tools.UtilTools.error("vxe.error.errConflicts",["merge-cells","span-method"]);var r=removeMerges(this,e,this.mergeList,this.afterFullData);return this.$nextTick().then(function(){return t.updateCellAreas(),r})},getMergeCells:function(){return this.mergeList.slice(0)},clearMergeCells:function(){return this.mergeList=[],this.$nextTick()},handleDefaultMergeFooterItems:function(){this.setMergeFooterItems(this.mergeFooterItems)},setMergeFooterItems:function(e){var t=this;return this.footerSpanMethod&&_tools.UtilTools.error("vxe.error.errConflicts",["merge-footer-items","footer-span-method"]),setMerges(this,e,this.mergeFooterList,null),this.$nextTick().then(function(){return t.updateCellAreas()})},removeMergeFooterItems:function(e){var t=this;this.footerSpanMethod&&_tools.UtilTools.error("vxe.error.errConflicts",["merge-footer-items","footer-span-method"]);var r=removeMerges(this,e,this.mergeFooterList,null);return this.$nextTick().then(function(){return t.updateCellAreas(),r})},getMergeFooterItems:function(){return this.mergeFooterList.slice(0)},clearMergeFooterItems:function(){return this.mergeFooterList=[],this.$nextTick()},updateZindex:function(){this.zIndex?this.tZindex=this.zIndex:this.tZindex<_tools.UtilTools.getLastZIndex()&&(this.tZindex=_tools.UtilTools.nextZIndex())},updateCellAreas:function(){this.mouseConfig&&this.mouseOpts.area&&this.handleUpdateCellAreas&&this.handleUpdateCellAreas()},emitEvent:function(e,t,r){this.$emit(e,Object.assign({$table:this,$grid:this.$xegrid,$event:r},t),r)},focus:function(){return this.isActivated=!0,this.$nextTick()},blur:function(){return this.isActivated=!1,this.$nextTick()},getEventTargetNode:getEventTargetNode,getCell:function(e,t){var r=this.$refs,i=getRowid(this,e),o=r["".concat(t.fixed||"table","Body")]||r.tableBody;return o&&o.$el?o.$el.querySelector('.vxe-body--row[data-rowid="'.concat(i,'"] .').concat(t.id)):null},connect:function(e){e&&e.syncUpdate?(e.syncUpdate({collectColumn:this.collectColumn,$table:this}),this.$toolbar=e):_tools.UtilTools.error("vxe.error.barUnableLink")}},funcs="setFilter,filter,clearFilter,closeMenu,setActiveCellArea,getActiveCellArea,getCellAreas,clearCellAreas,copyCellArea,cutCellArea,pasteCellArea,getCopyCellArea,clearCopyCellArea,setCellAreas,openFind,openReplace,getMouseSelecteds,getMouseCheckeds,getSelectedCell,getSelectedRanges,clearCopyed,clearChecked,clearHeaderChecked,clearIndexChecked,clearSelected,insert,insertAt,remove,removeSelecteds,removeCheckboxRow,removeRadioRow,removeCurrentRow,getRecordset,getInsertRecords,getRemoveRecords,getUpdateRecords,clearActived,getActiveRecord,getActiveRow,hasActiveRow,isActiveByRow,setActiveRow,setActiveCell,setSelectCell,clearValidate,fullValidate,validate,exportCsv,openExport,exportData,openImport,importData,readFile,importByFile,print".split(",");funcs.forEach(function(e){Methods[e]=function(){return this["_".concat(e)]?this["_".concat(e)].apply(this,arguments):null}});var _default=Methods;exports.default=_default;