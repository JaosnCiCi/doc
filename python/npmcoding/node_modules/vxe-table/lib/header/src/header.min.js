"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils/methods/xe-utils")),_tools=require("../../tools"),_util=require("./util");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,l){return t in e?Object.defineProperty(e,t,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[t]=l,e}var cellType="header",_default={name:"VxeTableHeader",props:{tableData:Array,tableColumn:Array,visibleColumn:Array,tableGroupColumn:Array,fixedColumn:Array,size:String,fixedType:String,isGroup:Boolean},data:function(){return{headerColumn:[]}},watch:{tableColumn:function(){this.uploadColumn()}},created:function(){this.uploadColumn()},mounted:function(){var e=this.$parent,t=this.$el,l=this.$refs,o=this.fixedType,r=e.elemStore,i="".concat(o||"main","-header-");r["".concat(i,"wrapper")]=t,r["".concat(i,"table")]=l.table,r["".concat(i,"colgroup")]=l.colgroup,r["".concat(i,"list")]=l.thead,r["".concat(i,"xSpace")]=l.xSpace,r["".concat(i,"repair")]=l.repair},render:function(w){var T=this,e=this._e,$=this.$parent,z=this.fixedType,t=this.headerColumn,l=this.fixedColumn,o=this.tableColumn,P=$.$listeners,r=$.tId,S=$.resizable,M=$.border,W=$.columnKey,i=$.headerRowClassName,D=$.headerCellClassName,n=$.headerRowStyle,U=$.headerCellStyle,k=$.showHeaderOverflow,I=$.headerAlign,R=$.align,A=$.highlightCurrentColumn,H=$.currentColumn,L=$.mouseConfig,q=$.scrollXLoad,E=$.overflowX,a=$.scrollbarWidth,O=$.getColumnIndex,B=$.sortOpts;return q&&z&&(o=l),w("div",{class:["vxe-table--header-wrapper",z?"fixed-".concat(z,"--wrapper"):"body--wrapper"],attrs:{"data-tid":r}},[z?e():w("div",{class:"vxe-body--x-space",ref:"xSpace"}),w("table",{class:"vxe-table--header",attrs:{"data-tid":r,cellspacing:0,cellpadding:0,border:0},ref:"table"},[w("colgroup",{ref:"colgroup"},o.map(function(e,t){return w("col",{attrs:{name:e.id},key:t})}).concat(a?[w("col",{attrs:{name:"col_gutter"}})]:[])),w("thead",{ref:"thead"},t.map(function(C,v){return w("tr",{class:["vxe-header--row",i?_xeUtils.default.isFunction(i)?i({$table:$,$rowIndex:v,fixed:z,type:cellType}):i:""],style:n?_xeUtils.default.isFunction(n)?n({$table:$,$rowIndex:v,fixed:z,type:cellType}):n:null},C.map(function(e,t){var l,o=e.showHeaderOverflow,r=e.headerAlign,i=e.align,n=e.headerClassName,a=e.children&&e.children.length,s=z?e.fixed!==z&&!a:e.fixed&&E,d=_xeUtils.default.isUndefined(o)||_xeUtils.default.isNull(o)?k:o,c=r||i||I||R,u="ellipsis"===d,f="title"===d,p=!0===d||"tooltip"===d,h=f||p||u,m={},x=e.filters&&e.filters.some(function(e){return e.checked}),y=O(e),g=$._getColumnIndex(e),_={$table:$,$rowIndex:v,column:e,columnIndex:y,$columnIndex:t,_columnIndex:g,fixed:z,type:cellType,isHidden:s,hasFilter:x};q&&!h&&(u=h=!0),(A||P["header-cell-click"]||L||"cell"===B.trigger)&&(m.click=function(e){return $.triggerHeaderCellClickEvent(e,_)}),P["header-cell-dblclick"]&&(m.dblclick=function(e){return $.triggerHeaderCellDBLClickEvent(e,_)}),L&&(m.mousedown=function(e){return $.triggerHeaderCellMousedownEvent(e,_)});var b="seq"===e.type||"index"===e.type?"seq":e.type;return w("th",{class:["vxe-header--column",e.id,(l={},_defineProperty(l,"col--".concat(c),c),_defineProperty(l,"col--".concat(b),b),_defineProperty(l,"col--last",t===C.length-1),_defineProperty(l,"col--fixed",e.fixed),_defineProperty(l,"col--group",a),_defineProperty(l,"col--ellipsis",h),_defineProperty(l,"fixed--hidden",s),_defineProperty(l,"is--sortable",e.sortable),_defineProperty(l,"is--filter",!!e.filters),_defineProperty(l,"filter--active",x),_defineProperty(l,"col--current",H===e),l),_tools.UtilTools.getClass(n,_),_tools.UtilTools.getClass(D,_)],attrs:{"data-colid":e.id,colspan:1<e.colSpan?e.colSpan:null,rowspan:1<e.rowSpan?e.rowSpan:null},style:U?_xeUtils.default.isFunction(U)?U(_):U:null,on:m,key:W||a?e.id:t},[w("div",{class:["vxe-cell",{"c--title":f,"c--tooltip":p,"c--ellipsis":u}]},e.renderHeader(w,_)),!s&&!a&&(_xeUtils.default.isBoolean(e.resizable)?e.resizable:S)?w("div",{class:["vxe-resizable",{"is--line":!M||"none"===M}],on:{mousedown:function(e){return T.resizeMousedown(e,_)}}}):null])}).concat(a?[w("th",{class:"col--gutter"})]:[]))}))]),w("div",{class:"vxe-table--header-border-line",ref:"repair"})])},methods:{uploadColumn:function(){this.headerColumn=this.isGroup?(0,_util.convertToRows)(this.tableGroupColumn):[this.$parent.scrollXLoad&&this.fixedType?this.fixedColumn:this.tableColumn]},resizeMousedown:function(e,t){var l=t.column,o=this.$parent,r=this.$el,i=this.fixedType,n=o.$refs,a=n.tableBody,s=n.leftContainer,d=n.rightContainer,c=n.resizeBar,u=e.target,f=e.clientX,p=u.parentNode,h=0,m=a.$el,x=_tools.DomTools.getOffsetPos(u,r),y=u.clientWidth,g=Math.floor(y/2),_=_tools.UtilTools.getColMinWidth(o,l)-g,b=x.left-p.clientWidth+y+_,C=x.left+g,v=document.onmousemove,w=document.onmouseup,T="left"===i,$="right"===i,z=0;if(T||$){for(var P=T?"nextElementSibling":"previousElementSibling",S=p[P];S&&!_tools.DomTools.hasClass(S,"fixed--hidden");)_tools.DomTools.hasClass(S,"col--group")||(z+=S.offsetWidth),S=S[P];$&&d&&(C=d.offsetLeft+z)}var M=function(e){e.stopPropagation(),e.preventDefault();var t=e.clientX-f,l=C+t,o=i?0:m.scrollLeft;l=T?Math.min(l,(d?d.offsetLeft:m.clientWidth)-z-_):$?(b=(s?s.clientWidth:0)+z+_,Math.min(l,C+p.clientWidth-_)):(b=Math.max(m.scrollLeft,b),Math.min(l,m.clientWidth+m.scrollLeft-40)),h=Math.max(l,b),c.style.left="".concat(h-o,"px")};o._isResize=!0,_tools.DomTools.addClass(o.$el,"drag--resize"),c.style.display="block",document.onmousemove=M,document.onmouseup=function(){document.onmousemove=v,document.onmouseup=w,l.resizeWidth=l.renderWidth+($?C-h:h-C),c.style.display="none",o._isResize=!1,o._lastResizeTime=Date.now(),o.analyColumnWidth(),o.saveCustomResizable(),o.recalculate(!0).then(function(){o.updateCellAreas()}),_tools.DomTools.removeClass(o.$el,"drag--resize"),o.emitEvent("resizable-change",t,e)},M(e)}}};exports.default=_default;