"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils/methods/xe-utils")),_conf=_interopRequireDefault(require("../../conf")),_vXETable=_interopRequireDefault(require("../../v-x-e-table")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var l=Object.prototype.toString.call(e).slice(8,-1);return"Object"===l&&e.constructor&&(l=e.constructor.name),"Map"===l||"Set"===l?Array.from(e):"Arguments"===l||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var l=0,r=new Array(t);l<t;l++)r[l]=e[l];return r}function _defineProperty(e,t,l){return t in e?Object.defineProperty(e,t,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[t]=l,e}var scrollProcessTimeout,cellType="body";function isOperateMouse(e){return e._isResize||e.lastScrollTime&&Date.now()<e.lastScrollTime+e.delayHover}function countTreeExpand(e,t){var l=t.$table,r=e[l.treeOpts.children],o=1;if(l.isTreeExpandByRow(e))for(var n=0;n<r.length;n++)o+=countTreeExpand(r[n],t);return o}function getOffsetSize(e){switch(e.vSize){case"mini":return 3;case"small":return 2;case"medium":return 1}return 0}function calcTreeLine(e,t){var l=e.$table,r=e.$rowIndex,o=1;return r&&(o=countTreeExpand(t[r-1],e)),l.rowHeight*o-(r?1:12-getOffsetSize(l))}function renderLine(e,t,l,r,o,n){var a=n.column,s=l.treeOpts,i=l.treeConfig;return a.slots&&a.slots.line?a.slots.line.call(l,n,e):a.treeNode&&i&&s.line?[e("div",{class:"vxe-tree--line-wrapper"},[e("div",{class:"vxe-tree--line",style:{height:"".concat(calcTreeLine(n,o),"px"),left:"".concat(r*s.indent+(r?2-getOffsetSize(l):0)+16,"px")}})])]:[]}function renderBorder(e,t){return e("div",{class:"vxe-table-".concat(t,"ed-borders"),ref:"".concat(t,"Borders")},[e("span",{class:"vxe-table-border-top",ref:"".concat(t,"Top")}),e("span",{class:"vxe-table-border-right",ref:"".concat(t,"Right")}),e("span",{class:"vxe-table-border-bottom",ref:"".concat(t,"Bottom")}),e("span",{class:"vxe-table-border-left",ref:"".concat(t,"Left")})])}function mergeMethod(e,t,l){for(var r=0;r<e.length;r++){var o=e[r],n=o.row,a=o.col,s=o.rowspan,i=o.colspan;if(-1<a&&-1<n&&s&&i){if(n===t&&a===l)return{rowspan:s,colspan:i};if(n<=t&&t<n+s&&a<=l&&l<a+i)return{rowspan:0,colspan:0}}}}function renderColumn(e,t,l,r,o,n,a,s,i,c,d,u,p,f,y,v){var x,g,b=l._e,m=l.$listeners,h=l.afterFullData,w=l.tableData,_=l.height,T=l.columnKey,C=l.overflowX,S=l.scrollXLoad,O=l.scrollYLoad,$=l.highlightCurrentRow,L=l.showOverflow,k=l.align,E=l.currentColumn,I=l.cellClassName,R=l.cellStyle,B=l.mergeList,A=l.spanMethod,P=l.radioOpts,U=l.checkboxOpts,q=l.expandOpts,D=l.treeOpts,M=l.tooltipOpts,H=l.mouseConfig,j=l.editConfig,N=l.editOpts,X=l.editRules,z=l.validOpts,F=l.editStore,W=l.validStore,Y=p.cellRender,K=p.editRender,G=p.align,V=p.showOverflow,J=p.className,Q=p.treeNode,Z=F.actived,ee=M.enabled,te=l.getColumnIndex(p),le=l._getColumnIndex(p),re=a?p.fixed!==a:p.fixed&&C,oe=_xeUtils.default.isUndefined(V)||_xeUtils.default.isNull(V)?L:V,ne="ellipsis"===oe,ae="title"===oe,se=!0===oe||"tooltip"===oe,ie=ae||se||ne,ce={},de=G||k,ue=W.row===i&&W.column===p,pe=X&&("default"===z.message?_||1<w.length:"inline"===z.message),fe={"data-colid":p.id},ye=m["cell-mouseenter"],ve=m["cell-mouseleave"],xe=K&&j&&"dblclick"===N.trigger,ge={$table:l,$seq:r,seq:o,rowid:n,row:i,rowIndex:c,$rowIndex:d,column:p,columnIndex:te,$columnIndex:f,_columnIndex:le,fixed:a,type:cellType,isHidden:re,level:s,visibleData:h,data:w,items:v};if(!S&&!O||ie||(ne=ie=!0),(ae||se||ee||ye)&&(ce.mouseenter=function(e){isOperateMouse(l)||(ae?_tools.DomTools.updateCellTitle(e.currentTarget,p):(se||ee)&&l.triggerBodyTooltipEvent(e,ge),ye&&l.emitEvent("cell-mouseenter",Object.assign({cell:e.currentTarget},ge),e))}),(se||ee||ve)&&(ce.mouseleave=function(e){isOperateMouse(l)||((se||ee)&&l.handleTargetLeaveEvent(e),ve&&l.emitEvent("cell-mouseleave",Object.assign({cell:e.currentTarget},ge),e))}),(U.range||H)&&(ce.mousedown=function(e){l.triggerCellMousedownEvent(e,ge)}),($||H||m["cell-click"]||K&&j||"row"===q.trigger||"cell"===q.trigger||"row"===P.trigger||"radio"===p.type&&"cell"===P.trigger||"row"===U.trigger||("checkbox"===p.type||"selection"===p.type)&&"cell"===U.trigger||"row"===D.trigger||p.treeNode&&"cell"===D.trigger)&&(ce.click=function(e){l.triggerCellClickEvent(e,ge)}),(xe||m["cell-dblclick"])&&(ce.dblclick=function(e){l.triggerCellDBLClickEvent(e,ge)}),B.length){var be=mergeMethod(B,u,le);if(be){var me=be.rowspan,he=be.colspan;if(!me||!he)return null;1<me&&(fe.rowspan=me),1<he&&(fe.colspan=he)}}else if(A){var we=A(ge)||{},_e=we.rowspan,Te=void 0===_e?1:_e,Ce=we.colspan,Se=void 0===Ce?1:Ce;if(!Te||!Se)return null;1<Te&&(fe.rowspan=Te),1<Se&&(fe.colspan=Se)}!re&&j&&(K||Y)&&N.showStatus&&(g=l.isUpdateByRow(i,p.property));var Oe="seq"===p.type||"index"===p.type?"seq":p.type;return e("td",{class:["vxe-body--column",p.id,(x={},_defineProperty(x,"col--".concat(de),de),_defineProperty(x,"col--".concat(Oe),Oe),_defineProperty(x,"col--last",f===y.length-1),_defineProperty(x,"col--tree-node",Q),_defineProperty(x,"col--edit",!!K),_defineProperty(x,"col--ellipsis",ie),_defineProperty(x,"fixed--hidden",re),_defineProperty(x,"col--dirty",g),_defineProperty(x,"col--actived",j&&K&&Z.row===i&&(Z.column===p||"row"===N.mode)),_defineProperty(x,"col--valid-error",ue),_defineProperty(x,"col--current",E===p),x),_tools.UtilTools.getClass(J,ge),_tools.UtilTools.getClass(I,ge)],key:T?p.id:f,attrs:fe,style:R?_xeUtils.default.isFunction(R)?R(ge):R:null,on:ce},L&&re?[e("div",{class:["vxe-cell",{"c--title":ae,"c--tooltip":se,"c--ellipsis":ne}]})]:renderLine(e,t,l,s,v,ge).concat([e("div",{class:["vxe-cell",{"c--title":ae,"c--tooltip":se,"c--ellipsis":ne}],attrs:{title:ae?_tools.UtilTools.getCellLabel(i,p,ge):null}},p.renderCell(e,ge)),pe?ue?e("div",{class:"vxe-cell--valid",style:W.rule&&W.rule.maxWidth?{width:"".concat(W.rule.maxWidth,"px")}:null},[e("span",{class:"vxe-cell--valid-msg"},W.content)]):b():null]))}function renderRows(y,v,x,g,b,m,h,w){var _=x.stripe,T=x.rowKey,C=x.highlightHoverRow,S=x.rowClassName,O=x.rowStyle,$=x.showOverflow,L=x.treeConfig,k=x.treeOpts,E=x.treeExpandeds,I=x.scrollYLoad,R=x.scrollYStore,B=x.editStore,A=x.rowExpandeds,P=x.radioOpts,U=x.checkboxOpts,q=x.expandColumn,D=[];return h.forEach(function(l,r){var e={},o=r,n=o+1;I&&(n+=R.startIndex);var a=x._getRowIndex(l);o=x.getRowIndex(l),C&&(e.mouseenter=function(e){isOperateMouse(x)||x.triggerHoverEvent(e,{row:l,rowIndex:o})},e.mouseleave=function(){isOperateMouse(x)||x.clearHoverRow()});var s=_tools.UtilTools.getRowid(x,l),t={$table:x,$seq:g,seq:n,rowid:s,fixed:m,type:cellType,rowLevel:b,row:l,rowIndex:o,$rowIndex:r};if(D.push(y("tr",{class:["vxe-body--row",{"row--stripe":_&&(x._getRowIndex(l)+1)%2==0,"is--new":-1<B.insertList.indexOf(l),"row--radio":P.highlight&&x.selectRow===l,"row--checked":U.highlight&&x.isCheckedByCheckboxRow(l)},S?_xeUtils.default.isFunction(S)?S(t):S:""],attrs:{"data-rowid":s},style:O?_xeUtils.default.isFunction(O)?O(t):O:null,key:T||L?s:r,on:e},w.map(function(e,t){return renderColumn(y,v,x,g,n,s,m,b,l,o,r,a,e,t,w,h)}))),q&&A.length&&-1<A.indexOf(l)){var i,c=x.getColumnIndex(q);L&&(i={paddingLeft:"".concat(b*k.indent+30,"px")});var d=q.showOverflow,u=_xeUtils.default.isUndefined(d)||_xeUtils.default.isNull(d)?$:d,p={$table:x,$seq:g,seq:n,column:q,columnIndex:c,fixed:m,type:cellType,level:b,row:l,rowIndex:o,$rowIndex:r};D.push(y("tr",{class:"vxe-body--expanded-row",key:"expand_".concat(s),style:O?_xeUtils.default.isFunction(O)?O(p):O:null,on:e},[y("td",{class:["vxe-body--expanded-column",{"fixed--hidden":m,"col--ellipsis":u}],attrs:{colspan:w.length}},[y("div",{class:"vxe-body--expanded-cell",style:i},[q.renderData(y,p)])])]))}if(L&&E.length){var f=l[k.children];f&&f.length&&-1<E.indexOf(l)&&D.push.apply(D,_toConsumableArray(renderRows(y,v,x,g?"".concat(g,".").concat(n):"".concat(n),b+1,m,f,w)))}}),D}function syncBodyScroll(e,t,l){(t||l)&&(t&&(t.onscroll=null,t.scrollTop=e),l&&(l.onscroll=null,l.scrollTop=e),clearTimeout(scrollProcessTimeout),scrollProcessTimeout=setTimeout(function(){t&&(t.onscroll=t._onscroll),l&&(l.onscroll=l._onscroll)},100))}var _default={name:"VxeTableBody",props:{tableData:Array,tableColumn:Array,visibleColumn:Array,fixedColumn:Array,size:String,fixedType:String,isGroup:Boolean},mounted:function(){var e=this.$parent,t=this.$el,l=this.$refs,r=this.fixedType,o=e.elemStore,n="".concat(r||"main","-body-");o["".concat(n,"wrapper")]=t,o["".concat(n,"table")]=l.table,o["".concat(n,"colgroup")]=l.colgroup,o["".concat(n,"list")]=l.tbody,o["".concat(n,"xSpace")]=l.xSpace,o["".concat(n,"ySpace")]=l.ySpace,o["".concat(n,"emptyBlock")]=l.emptyBlock,this.$el.onscroll=this.scrollEvent,this.$el._onscroll=this.scrollEvent},beforeDestroy:function(){this.$el._onscroll=null,this.$el.onscroll=null},render:function(l){var e,t=this._e,r=this.$parent,o=this.fixedColumn,n=this.fixedType,a=r.$scopedSlots,s=r.tId,i=r.tableData,c=r.tableColumn,d=r.showOverflow,u=r.mergeList,p=r.spanMethod,f=r.scrollXLoad,y=r.mouseConfig,v=r.mouseOpts,x=r.emptyRender,g=r.emptyOpts,b=r.keyboardConfig,m=void 0===b?{}:b,h=y&&v.checked;if(u.length||p||(n&&d?c=o:f&&n&&(c=o)),a.empty)e=a.empty.call(this,{$table:this},l);else{var w=x?_vXETable.default.renderer.get(g.name):null;e=w&&w.renderEmpty?w.renderEmpty.call(this,l,g,{$table:this},{$table:this}):_conf.default.i18n("vxe.table.emptyText")}return l("div",{class:["vxe-table--body-wrapper",n?"fixed-".concat(n,"--wrapper"):"body--wrapper"],attrs:{"data-tid":s}},[n?t():l("div",{class:"vxe-body--x-space",ref:"xSpace"}),l("div",{class:"vxe-body--y-space",ref:"ySpace"}),l("table",{class:"vxe-table--body",attrs:{"data-tid":s,cellspacing:0,cellpadding:0,border:0},ref:"table"},[l("colgroup",{ref:"colgroup"},c.map(function(e,t){return l("col",{attrs:{name:e.id},key:t})})),l("tbody",{ref:"tbody"},renderRows(l,this,r,"",0,n,i,c))]),n||!h&&!m.isCut?null:l("div",{class:"vxe-table--borders"},[h?renderBorder(l,"check"):null,m.isCut?renderBorder(l,"copy"):null]),l("div",{class:"vxe-table--checkbox-range"}),y&&v.area?l("div",{staticClass:"vxe-table--cell-area"},[l("span",{staticClass:"vxe-table--cell-main-area"},v.extension?[l("span",{staticClass:"vxe-table--cell-main-area-btn",on:{mousedown:function(e){r.triggerCellExtendMousedownEvent(e,{$table:r,fixed:n,type:cellType})}}})]:null),l("span",{staticClass:"vxe-table--cell-copy-area"}),l("span",{staticClass:"vxe-table--cell-extend-area"}),l("span",{staticClass:"vxe-table--cell-multi-area"}),l("span",{staticClass:"vxe-table--cell-active-area"})]):null,n?null:l("div",{class:"vxe-table--empty-block",ref:"emptyBlock"},[l("div",{class:"vxe-table--empty-content"},e)])])},methods:{scrollEvent:function(e){var t=this.$el,l=this.$parent,r=this.fixedType,o=l.$refs,n=l.highlightHoverRow,a=l.scrollXLoad,s=l.scrollYLoad,i=l.lastScrollTop,c=l.lastScrollLeft,d=o.tableHeader,u=o.tableBody,p=o.leftBody,f=o.rightBody,y=o.tableFooter,v=o.validTip,x=d?d.$el:null,g=y?y.$el:null,b=u.$el,m=p?p.$el:null,h=f?f.$el:null,w=t.scrollTop,_=b.scrollLeft,T=_!==c,C=w!==i;l.lastScrollTop=w,l.lastScrollLeft=_,l.lastScrollTime=Date.now(),n&&l.clearHoverRow(),m&&"left"===r?syncBodyScroll(w=m.scrollTop,b,h):h&&"right"===r?syncBodyScroll(w=h.scrollTop,b,m):(T&&(x&&(x.scrollLeft=b.scrollLeft),g&&(g.scrollLeft=b.scrollLeft)),(m||h)&&(l.checkScrolling(),C&&syncBodyScroll(w,m,h))),a&&T&&(l.triggerScrollXEvent(e),x&&_+b.clientWidth>=b.scrollWidth-80&&this.$nextTick(function(){b.scrollLeft!==x.scrollLeft&&(x.scrollLeft=b.scrollLeft)})),s&&C&&l.triggerScrollYEvent(e),T&&v&&v.visible&&v.updatePlacement(),l.emitEvent("scroll",{type:cellType,fixed:r,scrollTop:w,scrollLeft:_,isX:T,isY:C},e)}}};exports.default=_default;